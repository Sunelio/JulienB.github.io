;/*FB_PKG_DELIM*/

__d("MWChatEncryptedBackupsSettingsDialogQuery$Parameters",["MWChatEncryptedBackupsSettingsDialogQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a={kind:"PreloadableConcreteRequest",params:{id:b("MWChatEncryptedBackupsSettingsDialogQuery_facebookRelayOperation"),metadata:{},name:"MWChatEncryptedBackupsSettingsDialogQuery",operationKind:"query",text:null}};e.exports=a}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2ImplQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="7143386292434169"}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2ImplQuery.graphql",["useMWEncryptedBackupsFetchBackupIdsV2ImplQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useMWEncryptedBackupsFetchBackupIdsV2ImplQuery",selections:[{args:null,kind:"FragmentSpread",name:"useMWEncryptedBackupsFetchBackupIdsV2Impl_query"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"useMWEncryptedBackupsFetchBackupIdsV2ImplQuery",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"encryption_management_delegator_id",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null},a],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesConnection",kind:"LinkedField",name:"devices",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEBDevice",kind:"LinkedField",name:"node",plural:!1,selections:[a],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEBUserPreferences",kind:"LinkedField",name:"xfb_eb_user_preferences",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"onboarding_decision",storageKey:null},a],storageKey:null}]},params:{id:b("useMWEncryptedBackupsFetchBackupIdsV2ImplQuery_facebookRelayOperation"),metadata:{},name:"useMWEncryptedBackupsFetchBackupIdsV2ImplQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2Impl_query.graphql",["useMWEncryptedBackupsFetchBackupIdsV2ImplQuery.graphql"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{argumentDefinitions:[],kind:"Fragment",metadata:{refetch:{connection:null,fragmentPathInResult:[],operation:b("useMWEncryptedBackupsFetchBackupIdsV2ImplQuery.graphql")}},name:"useMWEncryptedBackupsFetchBackupIdsV2Impl_query",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"encryption_management_delegator_id",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesConnection",kind:"LinkedField",name:"devices",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEBDevice",kind:"LinkedField",name:"node",plural:!1,selections:[a],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEBUserPreferences",kind:"LinkedField",name:"xfb_eb_user_preferences",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"onboarding_decision",storageKey:null}],storageKey:null}],type:"Query",abstractKey:null}}();e.exports=a}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2Query_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="7376203159158541"}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2Query.graphql",["useMWEncryptedBackupsFetchBackupIdsV2Query_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useMWEncryptedBackupsFetchBackupIdsV2Query",selections:[{args:null,kind:"FragmentSpread",name:"useMWEncryptedBackupsFetchBackupIdsV2Impl_query"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"useMWEncryptedBackupsFetchBackupIdsV2Query",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"encryption_management_delegator_id",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null},a],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesConnection",kind:"LinkedField",name:"devices",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEBDevice",kind:"LinkedField",name:"node",plural:!1,selections:[a],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEBUserPreferences",kind:"LinkedField",name:"xfb_eb_user_preferences",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"onboarding_decision",storageKey:null},a],storageKey:null}]},params:{id:b("useMWEncryptedBackupsFetchBackupIdsV2Query_facebookRelayOperation"),metadata:{},name:"useMWEncryptedBackupsFetchBackupIdsV2Query",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("VestaServerGraphQLLoginProviderBeginLoginMutation_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="4901700173259892"}),null);
__d("VestaServerGraphQLLoginProviderBeginLoginMutation.graphql",["VestaServerGraphQLLoginProviderBeginLoginMutation_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],c=[{alias:null,args:[{kind:"Variable",name:"begin_login_request",variableName:"input"}],concreteType:"VestaBeginLoginResponse",kind:"LinkedField",name:"fbid_based_auth_layer_vesta_begin_login",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_l2",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_l2_sig",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"VestaServerGraphQLLoginProviderBeginLoginMutation",selections:c,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"VestaServerGraphQLLoginProviderBeginLoginMutation",selections:c},params:{id:b("VestaServerGraphQLLoginProviderBeginLoginMutation_facebookRelayOperation"),metadata:{},name:"VestaServerGraphQLLoginProviderBeginLoginMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("VestaServerGraphQLLoginProviderFinishLoginMutation_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="5072170542843500"}),null);
__d("VestaServerGraphQLLoginProviderFinishLoginMutation.graphql",["VestaServerGraphQLLoginProviderFinishLoginMutation_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],c=[{alias:null,args:[{kind:"Variable",name:"finish_login_request",variableName:"input"}],concreteType:"VestaFinishLoginResponse",kind:"LinkedField",name:"fbid_based_auth_layer_vesta_finish_login",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_login_payload",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"login_success",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"attempts_remaining",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"VestaServerGraphQLLoginProviderFinishLoginMutation",selections:c,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"VestaServerGraphQLLoginProviderFinishLoginMutation",selections:c},params:{id:b("VestaServerGraphQLLoginProviderFinishLoginMutation_facebookRelayOperation"),metadata:{},name:"VestaServerGraphQLLoginProviderFinishLoginMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("VestaServerGraphQLLoginProviderInitQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="7267509326655323"}),null);
__d("VestaServerGraphQLLoginProviderInitQuery.graphql",["VestaServerGraphQLLoginProviderInitQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"request"}],c=[{alias:null,args:[{kind:"Variable",name:"vesta_init_request",variableName:"request"}],concreteType:"VestaInitIqResponse",kind:"LinkedField",name:"fbid_based_auth_layer_vesta_login_init",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_island_rsa_pub",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_island_rsa_pub_signature",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_pub",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_pub_signature",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_island_ed25519_pub",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_island_ed25519_pub_signature",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_registered",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"attempts_remaining",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"VestaServerGraphQLLoginProviderInitQuery",selections:c,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"VestaServerGraphQLLoginProviderInitQuery",selections:c},params:{id:b("VestaServerGraphQLLoginProviderInitQuery_facebookRelayOperation"),metadata:{},name:"VestaServerGraphQLLoginProviderInitQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("useMWDropEBDbMenuDialog",["fbt","MAWEncryptedBackupsPersistedDB","asyncToGeneratorRuntime","promiseDone","setTimeout","useMWXConfirmationDialog"],(function(a,b,c,d,e,f,g,h){"use strict";function a(){var a=c("useMWXConfirmationDialog")();function e(){return f.apply(this,arguments)}function f(){f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("MAWEncryptedBackupsPersistedDB").deleteEBIDB()});return f.apply(this,arguments)}return function(){return a({body:h._("__JHASH__DcM8TCyeV5W__JHASH__"),cancel:h._("__JHASH__m8lIvy2pF-q__JHASH__"),confirm:h._("__JHASH__pOCM-0rZl3___JHASH__"),title:h._("__JHASH__icqZlIIHBX0__JHASH__")},function(){c("promiseDone")(e().then(function(){c("setTimeout")(function(){window.location.reload()},500)}))})}}g["default"]=a}),226);
__d("MWDropEBDbMenu.react",["MWXIconMenuItemTextAlignLeft","cr:5086","react","useMWDropEBDbMenuDialog"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(){var a=c("useMWDropEBDbMenuDialog")();return b("cr:5086")!=null?i.jsx(b("cr:5086"),{icon:c("MWXIconMenuItemTextAlignLeft"),onClick:a,primaryText:"[Fb-only] Clear persisted EB DB"}):null}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("LSOnboardFromExistingDeviceStart",["LSGetLatestEpochKeys","LSIssueNewTask","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][onboardFromExistingDeviceStart] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.db.table(282).add({stateKey:"auto_restored",stateValue:"true"})},function(b){return c.db.table(185).add({pk:c.i64.cast([0,1]),backupId:a[0],deviceRegistrationId:a[2],taskId:c.i64.cast([0,1])})},function(a){return c.storedProcedure(b("LSGetLatestEpochKeys"),!1).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],a})},function(e){return d[2]!==void 0?c.sequence([function(e){return d[11]=d[2].get("epoch_keys"),d[2],d[12]=d[11].get("epoch_id"),d[11],d[13]=new c.Map(),d[13].set("existing_device_id",a[1]),d[13].set("base_epoch_id",d[12]),d[14]=new c.Map(),d[14].set("success",d[13]),d[15]=c.toJSON(d[14]),c.storedProcedure(b("LSIssueNewTask"),"meb_onboard_from_existing_device",c.i64.cast([0,50036]),d[15],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return d[4]=void 0}]):c.sequence([function(a){return d[3]!==void 0?c.sequence([function(a){return d[12]=d[3].get("error_message"),d[3],d[13]=d[3].get("error_code"),d[3],d[14]=new c.Map(),d[14].set("error_code",d[13]),d[14].set("stored_procedure","onboardFromExistingDeviceStart"),d[14].set("error_message",d[12]),d[15]=new c.Map(),d[15].set("failure",d[14]),d[16]=c.toJSON(d[15]),c.storedProcedure(b("LSIssueNewTask"),"meb_onboard_from_existing_device",c.i64.cast([0,50036]),d[16],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return d[17]=new c.Map(),d[17].set("error_code",d[13]),d[17].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceStartStoredProcedure"),d[17].set("error_message",""),d[11]=d[17]}]):c.sequence([function(a){return d[12]=new c.Map(),d[12].set("error_code",c.i64.cast([0,603])),d[12].set("stored_procedure","onboardFromExistingDeviceStart"),d[12].set("error_message","Unknown error encountered"),d[13]=new c.Map(),d[13].set("failure",d[12]),d[14]=c.toJSON(d[13]),c.storedProcedure(b("LSIssueNewTask"),"meb_onboard_from_existing_device",c.i64.cast([0,50036]),d[14],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return d[15]=new c.Map(),d[15].set("error_code",c.i64.cast([0,603])),d[15].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceStartStoredProcedure"),d[15].set("error_message",""),d[11]=d[15]}])},function(a){return d[4]=d[11]}])},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][onboardFromExistingDeviceStart] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"onboardFromExistingDeviceStart",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[4]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSOnboardFromExistingDeviceStartStoredProcedure",["LSOnboardFromExistingDeviceStart","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.backupId;d[1]=b.previousDeviceId;d[2]=b.newDeviceRegistrationId;return c("LSOnboardFromExistingDeviceStart").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("MWEncryptedBackupsInitializeRestoreDeferred",["MWChatEncryptedBackupsQPLEvents","QPLUserFlow","WALogger","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Error initializing restore: ",""]);h=function(){return a};return a}var i=c("requireDeferred")("MWEncryptedBackupsInitializeRestore").__setRef("MWEncryptedBackupsInitializeRestoreDeferred");function a(a){var b=a.db,e=a.onFailure,f=a.onSuccess;i.onReady(function(a){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"add_device_init_restore_sproc"),c("promiseDone")(a.initializeRestoreStoredProcedure(b),f,function(a){d("WALogger").ERROR(h(),a),e==null?void 0:e()})})}g.encryptedBackupsInitializeRestoreDeferred=a}),98);
__d("MWChatEncryptedBackupsAddDeviceWithEBKeys",["ClientConsistencyEventEmitter","CurrentUser","EBSMGating","FBLogger","I64","LSAuthorityLevel","LSFactory","LSIntEnum","LSOnboardFromExistingDeviceStartStoredProcedure","LSShape","MAWEncryptedBackupsPersistedDB","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEBODSEntityName.enum","MWEncryptedBackupsInitializeRestoreDeferred","MWEncryptedBackupsLocalStorageEntryEnum","MWEncryptedBackupsSharedState","QPLUserFlow","ReQL","WALogger","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][auto_restore] unexpected error when calling add device sproc: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][auto_restore] error when auto restoring: ",""]);k=function(){return a};return a}var l=c("requireDeferred")("MWEBUseLocalStorage").__setRef("MWChatEncryptedBackupsAddDeviceWithEBKeys"),m=c("requireDeferred")("MWEncryptedBackupsFetchBackupIds").__setRef("MWChatEncryptedBackupsAddDeviceWithEBKeys");function a(a){var b=a.backupId,e=a.db,f=a.newDeviceRegistrationId,g=a.previousDeviceId;c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"START_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC");e.runInTransaction(function(a){return c("LSOnboardFromExistingDeviceStartStoredProcedure")(c("LSFactory")(a),{backupId:b,newDeviceRegistrationId:f,previousDeviceId:g})},"readwrite").then(function(a){a=a[0];c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"END_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC");if(a!=null){var b;a=d("LSShape").toRecord(a).error_message;c("QPLUserFlow").addPoint((b=d("MWChatEncryptedBackupsQPLEvents")).restoreDeviceAuthQplEvent,"FAIL_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC_WIPE_EBSM");c("QPLUserFlow").addPoint(b.restoreQplEvent,"FAIL_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC_WIPE_EBSM");d("MWChatEncryptedBackupsLogging").endFailure({errorName:a,event:b.restoreQplEvent});d("MWChatEncryptedBackupsLogging").endFailure({errorName:a,event:b.restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH});d("WALogger").ERROR(k(),a);c("promiseDone")(d("MAWEncryptedBackupsPersistedDB").deleteEBIDB());switch(c("CurrentUser").getAppID()){case 772021112871879..toString():c("ClientConsistencyEventEmitter").emit("hardRefresh","ls_forced_refresh");break;default:c("ClientConsistencyEventEmitter").emit("softRefresh","ls_forced_refresh")}return}var f=d("ReQL").fromTableAscending(e.tables.secure_encrypted_backups_client_state).subscribe(function(a,b){if(b.operation==="add"||b.operation==="put"){a=b.value.authorityLevel;(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))&&(c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"END_LS_ADD_DEVICE_WITH_EB_KEYS_TASK"),f(),c("promiseDone")(d("MWEncryptedBackupsSharedState").upsertEBSharedStateEntry({db:e,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY})),l.onReady(function(a){var b=a.mwEBCreateLocalStorageEntry;a=a.mwEBDeleteLocalStorageEntry;b(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION);b(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION_2);a(c("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE)}),d("MWEncryptedBackupsInitializeRestoreDeferred").encryptedBackupsInitializeRestoreDeferred({db:e,onFailure:function(){d("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{is_backend_setup:d("EBSMGating").isBackendSetupSuccessfulForEBSM()}},errorName:"FAILED_TO_RESTORE_ENCRYPTED_BACKUP",event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),d("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{is_backend_setup:d("EBSMGating").isBackendSetupSuccessfulForEBSM()}},errorName:"FAILED_TO_RESTORE_ENCRYPTED_BACKUP",event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH})},onSuccess:function(){c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{restore_type:"auto_restore"}}),d("MWChatEncryptedBackupsLogging").endSuccess({annotations:{bool:{is_backend_setup:d("EBSMGating").isBackendSetupSuccessfulForEBSM()}},event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH})}}),m.onReady(function(a){a=a.encryptedBackupsFetchBackupIds;a(e)["catch"](function(a){return c("FBLogger")("labyrinth_web").mustfix("Auto restore: Error when fetching backup ids, %s",a)})}))}})})["catch"](function(a){d("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{is_backend_setup:d("EBSMGating").isBackendSetupSuccessfulForEBSM()}},errorName:a,event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),d("MWChatEncryptedBackupsLogging").endFailure({errorName:a,event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),d("WALogger").ERROR(j(),a)})}g.addDeviceWithEBKeys=a}),98);
__d("LSAddDevice",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDataTrace","LSCreateDataTraceID.nop","LSFlushDataTrace.nop","LSGetViewerFBID","LSHandleWrongRecoveryCode","LSIsMobileClient","LSIssueNewTaskAndGetTaskID","LSIssueNewTaskUsingSyncChannel","LSLogMebClientEvent.nop","LSParseRecoveryCode_v2.nop","gkx","justknobx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(f){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Beginning execution."),(c("gkx")("23657")||c("gkx")("26375"))&&c("justknobx")._("946")?d.sequence([function(c){return d.i64.eq(a[3],d.i64.cast([0,2]))?e[8]=d.i64.cast([0,199]):e[8]=d.i64.cast([0,71]),a[4]!==void 0?d.sequence([function(a){return e[18]="EncryptedBackups Trace ID",e[19]=d.i64.to_string(e[8]),e[17]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",e[17],e[18],e[17],e[19]].join("")),d.resolve()},function(c){return d.storedProcedure(b("LSCreateDataTrace"),a[4],void 0,void 0,"backup_init_flow",e[8])},function(b){return e[9]=a[4]}]):d.sequence([function(a){return d.nativeOperation(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,e[17]=a[0],a})},function(a){return e[21]="EncryptedBackups MCD Trace ID",e[22]=d.i64.to_string(e[8]),e[18]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",e[18],e[21],e[18],e[22]].join("")),d.resolve()},function(a){return d.storedProcedure(b("LSCreateDataTrace"),e[17],void 0,void 0,"backup_init_flow",e[8])},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[19]=a[0],a})},function(a){return e[19]?e[20]=!0:e[20]=!1,e[20]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[23]=d.createArray(),void 0!==void 0?e[24]=(e[23].push(void 0),e[23]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[23],d.i64.cast([0,3]))):d.resolve()},function(a){return e[9]=e[17]}])},function(a){return e[9]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),e[9],d.i64.cast([0,1413]),d.i64.cast([0,2]),void 0,void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[10]=a[0],a})},function(a){return e[10]?e[11]=!0:e[11]=!1,e[11]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[17]=d.createArray(),void 0!==void 0?e[18]=(e[17].push(void 0),e[17]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[17],d.i64.cast([0,3]))):d.resolve()},function(a){return e[12]=d.createArray(),d.forEach(d.db.table(179).fetch(),function(a){var b=a.item;return d.sequence([function(a){return e[19]=b.taskId,d.db.table(2).fetch([[[e[19]]]]).next().then(function(a,b){b=a.done;a=a.value;return b?e[17]=!1:(a.item,e[17]=!0)})},function(a){return e[17]?0:e[20]=(e[12].push(e[19]),e[12])}])})},function(a){return e[13]=d.i64.of_int32(e[12].length),d.i64.gt(e[13],d.i64.cast([0,0]))?d.loopAsync(e[13],function(a){return e[17]=a,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[12],e[17]).then(function(a){return a=a,e[18]=a[0],e[19]=a[1],a})},function(a){return d.forEach(d.db.table(179).fetch([[[e[18]]]]),function(a){return a["delete"]()})}])}):d.resolve()},function(a){return d.db.table(179).fetch().next().then(function(a,b){b=a.done;a=a.value;return b?e[14]=!1:(a.item,e[14]=!0)})},function(c){return e[14]?d.sequence([function(a){return e[17]="Aborting addDevice execution as there is an existing pending task",e[17]!==void 0?d.sequence([function(a){return e[21]=["[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] ","",e[17]].join(""),function(a){d.logger(a).mustfix(a)}(e[21]),e[18]=d.createArray(),e[9]!==void 0?e[22]=(e[18].push(e[9]),e[18]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceStoredProcedure",e[17],e[18],d.i64.cast([0,3]))},function(a){return e[9]!==void 0?d.sequence([function(a){return e[9]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),e[9],d.i64.cast([0,85]),d.i64.cast([0,2]),e[21],void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[22]=a[0],a})},function(a){return e[22]?e[23]=!0:e[23]=!1,e[23]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[24]=d.createArray(),void 0!==void 0?e[25]=(e[24].push(void 0),e[24]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[24],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(a){return e[9]!==void 0?d.nativeOperation(b("LSFlushDataTrace.nop"),e[9]):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[19]=a[0],a})},function(a){return e[19]?e[20]=!0:e[20]=!1,e[20]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[22]=d.createArray(),void 0!==void 0?e[23]=(e[22].push(void 0),e[22]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[22],d.i64.cast([0,3]))):d.resolve()}]):d.sequence([function(a){return e[9]!==void 0?d.sequence([function(a){return e[9]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),e[9],d.i64.cast([0,85]),d.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] ","",""].join(""),void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[20]=a[0],a})},function(a){return e[20]?e[21]=!0:e[21]=!1,e[21]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[22]=d.createArray(),void 0!==void 0?e[23]=(e[22].push(void 0),e[22]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[22],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(a){return e[9]!==void 0?d.nativeOperation(b("LSFlushDataTrace.nop"),e[9]):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[18]=a[0],a})},function(a){return e[18]?e[19]=!0:e[19]=!1,e[19]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[20]=d.createArray(),void 0!==void 0?e[21]=(e[20].push(void 0),e[20]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[20],d.i64.cast([0,3]))):d.resolve()}])},function(a){return e[16]=d.i64.cast([0,1])}]):d.sequence([function(b){return e[17]=d.createArray(),d.forEach(d.filter(d.db.table(184).fetch(),function(b){return d.i64.eq(b.backupId,a[0])}),function(a){a=a.item;return e[23]=new d.Map(),e[23].set("virtual_device_id",a.virtualDeviceId),e[24]=(e[17].push(e[23]),e[17])})},function(a){return d.db.table(172).fetch().next().then(function(a,b){var c=a.done;a=a.value;return c?e[18]=void 0:(b=a.item,e[24]=b.encryptionManagementDelegatorId,d.i64.neq(e[24],void 0)?(d.i64.neq(e[24],d.i64.cast([0,0]))?e[25]=d.i64.to_string(e[24]):e[25]=void 0,e[23]=e[25]):e[23]=void 0,e[18]=e[23])})},function(a){return d.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,e[20]=a[0],a})},function(c){return d.nativeOperation(b("LSParseRecoveryCode_v2.nop"),a[1],e[18]==null?d.i64.to_string(e[20]):e[18],e[17]).then(function(a){return a=a,e[21]=a[0],e[22]=a[1],a})},function(c){return d.blobs.neq(e[21],void 0)?d.blobs.neq(e[22],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[21]).then(function(a){return a=a,e[23]=a[0],a})},function(a){return e[26]=e[23]==null?"":e[23],d.db.table(178).put({pk:d.i64.cast([0,1]),recoveryCodeStatus:d.i64.cast([0,1])})},function(c){return e[24]=d.i64.cast([0,0]),d.sequence([function(c){return e[27]=new d.Map(),e[27].set("backup_id",a[0]),e[27].set("virtual_device_id",e[26]),e[27].set("trace_id",e[9]),d.i64.gt(d.i64.cast([0,0]),d.i64.cast([0,0]))?(e[31]=d.i64.of_float(Date.now()),e[28]=d.i64.add(e[31],d.i64.cast([0,0]))):e[28]=d.i64.cast([0,0]),e[29]=d.toJSON(e[27]),d.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),"encrypted_backups_setup",d.i64.cast([0,50007]),e[29],void 0,void 0,d.i64.cast([0,0]),d.i64.cast([0,0]),void 0,void 0,e[28],e[24]).then(function(a){return a=a,e[30]=a[0],a})},function(a){return e[25]=e[30]}])},function(b){return d.db.table(185).add({pk:d.i64.cast([0,1]),backupId:a[0],deviceRegistrationId:a[2],taskId:e[25]})},function(a){return d.db.table(179).add({taskId:e[25],virtualDeviceId:e[21],blobDecryptionKey:e[22]})}]):d.storedProcedure(b("LSHandleWrongRecoveryCode"),e[9],"[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Wrong recovery code. blob_decryption_key is null",!0):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Wrong recovery code"),e[23]=d.createArray(),void 0!==void 0?e[24]=(e[23].push(void 0),e[23]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceStoredProcedure","Wrong recovery code",e[23],d.i64.cast([0,3]))},function(a){return d.storedProcedure(b("LSHandleWrongRecoveryCode"),e[9],"[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] Wrong recovery code. virtual_device_id is null",!0)}])},function(a){return e[16]=d.i64.cast([0,0])}])},function(a){return e[1]=e[16]}]):d.resolve((function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] addDeviceFlow is not enabled"),e[1]=d.i64.cast([0,1])))},function(a){return e[2]=d.i64.of_float(Date.now()),e[3]=d.i64.random(),e[5]="Finishing execution. Execution time: ",e[6]=d.i64.to_string(d.i64.sub(e[2],e[0])),e[7]=" ms",e[4]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsAddDeviceStoredProcedure] ",e[4],e[5],e[4],e[6],e[4],e[7]].join("")),d.i64.eq(d.i64.mod_(e[3],d.i64.cast([0,100])),d.i64.cast([0,0]))?(e[8]=",",e[9]=d.createArray(),void 0!==void 0?e[10]=(e[9].push(void 0),e[9]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceStoredProcedure",[e[5],e[8],e[6],e[8],e[7]].join(""),e[9],d.i64.cast([0,4]))):d.resolve()},function(a){return f[0]=e[1]}])},function(a){return d.resolve(f)}])}d=a;g["default"]=d}),98);
__d("LSAddDeviceStoredProcedure",["LSAddDevice","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.backupId;d[1]=b.recoveryCode;d[2]=b.deviceRegistrationId;d[3]=b.backupTenancy;d[4]=b.traceId;return c("LSAddDevice").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("MWEncryptedBackupsRecoveryCodeStatus",["FBLogger","I64","LSEncryptedBackupsRecoveryCodeStatus"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=a.onFailure,e=a.onInvalidRecoveryCode,f=a.onSuccess;a=a.recoveryCodeStatusData;if((a==null?void 0:a.length)!==1)return;a=a[0].recoveryCodeStatus;switch((h||(h=d("I64"))).to_int32(a)){case c("LSEncryptedBackupsRecoveryCodeStatus").OPTIMISTIC:return c("LSEncryptedBackupsRecoveryCodeStatus").OPTIMISTIC;case c("LSEncryptedBackupsRecoveryCodeStatus").INVALID:e==null?void 0:e();return c("LSEncryptedBackupsRecoveryCodeStatus").INVALID;case c("LSEncryptedBackupsRecoveryCodeStatus").VALID:f==null?void 0:f();return c("LSEncryptedBackupsRecoveryCodeStatus").VALID;case c("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR:b==null?void 0:b();return c("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR;default:b==null?void 0:b(),c("FBLogger")("labyrinth_web").mustfix("Invalid Recovery Code Status type")}}g.encryptedBackupsGetRecoveryCodeStatus=a}),98);
__d("mwEBAddDevice",["FBLogger","I64","LSAddDeviceStoredProcedure","LSDataTraceCheckPoint","LSEncryptedBackupsBackupTenancy","LSFactory","LSIntEnum","MAWBridgeFireAndForget","MAWTraceUtils","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsInitializeRestoreDeferred","MWEncryptedBackupsRecoveryCodeStatus","Promise","QPLUserFlow","ReQL","isInstamadilloEB","promiseDone","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a){var e=a.onFailure,f=a.onInvalidRecoveryCode,g=a.onStart,k=a.onSuccess,l=a.recoveryCode,m=a.storage,n=a.traceId,o=function(){},p=!1;a=new(j||(j=b("Promise")))(function(a,b){c("setTimeout")(function(){if(p)return;var a="Add device failed by timeout 90 sec";c("FBLogger")("labyrinth_web").mustfix(a);o();e();b(a)},9e4)});var q=new j(function(a,p){g(),o=m.table("secure_encrypted_backups_recovery_code_status").subscribe(function(b,g){if(g.operation==="delete")return;b=[g.value];c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"add_device_check_rc_status");d("MWEncryptedBackupsRecoveryCodeStatus").encryptedBackupsGetRecoveryCodeStatus({onFailure:function(){var a="LSEncryptedBackupsRecoveryCodeStatus system error";d("MAWTraceUtils").recordFailureAndFlushForTraceId(n,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_RESTORE_FAILURE),[],a);o();e();p(a)},onInvalidRecoveryCode:function(){var a="Invalid recovery code";d("MAWTraceUtils").recordFailureAndFlushForTraceId(n,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_RESTORE_FAILURE),[],a);o();f();p(a)},onSuccess:function(){d("MAWTraceUtils").recordSuccessAndFlushForTraceId(n,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PLUGIN_CALLING_INITIALIZE_RESTORE),[]),c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"add_device_init_restore"),o(),!c("isInstamadilloEB")()?(d("MAWBridgeFireAndForget").fireAndForget("backend","checkForDecryptionFailuresToPointRestore"),d("MWEncryptedBackupsInitializeRestoreDeferred").encryptedBackupsInitializeRestoreDeferred({db:m,onFailure:e,onSuccess:k})):(c("QPLUserFlow").endSuccess(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent),k()),a()},recoveryCodeStatusData:b})}),c("promiseDone")(d("ReQL").firstAsync(d("ReQL").fromTableAscending(m.table("encrypted_backups"))).then(function(a){var e=a==null?void 0:a.backupId;if(e!=null){var f=d("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();if(f==="")return(j||(j=b("Promise"))).reject("deviceRegistrationId is not defined");c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"add_device_lsadddevice_sproc");return m.runInTransaction(function(a){return c("LSAddDeviceStoredProcedure")(c("LSFactory")(a),{backupId:e,backupTenancy:(i||(i=d("I64"))).of_int32(c("LSEncryptedBackupsBackupTenancy").PRODUCTION),deviceRegistrationId:f,recoveryCode:l})},"readwrite")}else return(j||(j=b("Promise"))).reject("backupId is not defined")})["catch"](function(a){var b="Add device failed. encrypted_backups table or LSAddDevice sproc";c("FBLogger")("labyrinth_web").catching(a).mustfix(b);d("MAWTraceUtils").recordFailureAndFlushForTraceId(n,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_RESTORE_FAILURE),[],"Add Device Failure");o();e();p(b)}))});return j.race([q,a]).then(function(){p=!0})}g["default"]=a}),98);
__d("LSFetchBackupsMetadata",["LSAppendDataTraceAddon","LSCreateDataTrace","LSCreateDataTraceID.nop","LSFlushDataTrace.nop","LSIsMobileClient","LSIssueNewTask","LSLogMebClientEvent.nop","gkx","justknobx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(f){return d.sequence([function(f){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFetchBackupsMetadataStoredProcedure] Beginning execution."),(c("gkx")("23657")||c("gkx")("26375"))&&c("justknobx")._("1101")?d.sequence([function(c){return a[0]!==void 0?d.resolve(e[7]=a[0]):d.sequence([function(a){return d.islc(d.filter(d.db.table(168).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))&&d.i64.eq(a.backupTenancy,d.i64.cast([0,2]))}),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(a,b){b=a.done;a=a.value;return b?e[12]=!1:(a.item,e[12]=!0)})},function(a){return e[12]?e[14]=d.i64.or_(d.i64.cast([0,86]),d.i64.cast([0,128])):e[14]=d.i64.cast([0,86]),d.nativeOperation(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,e[15]=a[0],a})},function(a){return e[19]="EncryptedBackups MCD Trace ID",e[20]=d.i64.to_string(e[14]),e[16]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",e[16],e[19],e[16],e[20]].join("")),d.resolve()},function(a){return d.storedProcedure(b("LSCreateDataTrace"),e[15],void 0,void 0,"backup_metadata",e[14])},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[17]=a[0],a})},function(a){return e[17]?e[18]=!0:e[18]=!1,e[18]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[21]=d.createArray(),void 0!==void 0?e[22]=(e[21].push(void 0),e[21]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[21],d.i64.cast([0,3]))):d.resolve()},function(a){return e[7]=e[15]}])},function(a){return e[7]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),e[7],d.i64.cast([0,1478]),d.i64.cast([0,2]),void 0,void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[8]=a[0],a})},function(a){return e[8]?e[9]=!0:e[9]=!1,e[9]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[12]=d.createArray(),void 0!==void 0?e[13]=(e[12].push(void 0),e[12]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[12],d.i64.cast([0,3]))):d.resolve()},function(a){return d.forEach(d.db.table(196).fetch(),function(a){return a["delete"]()})},function(a){return d.db.table(172).fetch([[[d.i64.cast([0,1])]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?e[10]=void 0:(b=a.item,e[10]=b.backupId)})},function(a){return d.i64.neq(e[10],void 0)?d.sequence([function(a){return d.forEach(d.filter(d.db.table(196).fetch([[[e[10]]]]),function(a){return d.i64.eq(a.backupId,e[10])&&d.i64.lt(a.authorityLevel,d.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(a){return d.db.table(196).add({backupId:e[10],authorityLevel:d.i64.cast([0,20]),backupSize:d.i64.cast([0,0]),creationTime:d.i64.cast([0,0]),lastSyncTime:d.i64.cast([0,0])})},function(a){return e[12]=new d.Map(),e[12].set("trace_id",e[7]),e[13]=d.toJSON(e[12]),d.storedProcedure(b("LSIssueNewTask"),"encrypted_backups_setup",d.i64.cast([0,50022]),e[13],void 0,void 0,d.i64.cast([0,0]),d.i64.cast([0,0]),void 0,void 0,d.i64.cast([0,0]),d.i64.cast([0,0]))}]):d.sequence([function(a){return e[12]="Backup is not initialized",e[12]!==void 0?d.sequence([function(a){return e[16]=["[EncryptedBackups][LSEncryptedBackupsFetchBackupsMetadataStoredProcedure] ","",e[12]].join(""),function(a){d.logger(a).mustfix(a)}(e[16]),e[13]=d.createArray(),e[7]!==void 0?e[17]=(e[13].push(e[7]),e[13]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFetchBackupsMetadataStoredProcedure",e[12],e[13],d.i64.cast([0,3]))},function(a){return e[7]!==void 0?d.sequence([function(a){return e[7]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),e[7],d.i64.cast([0,85]),d.i64.cast([0,2]),e[16],void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[17]=a[0],a})},function(a){return e[17]?e[18]=!0:e[18]=!1,e[18]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[19]=d.createArray(),void 0!==void 0?e[20]=(e[19].push(void 0),e[19]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[19],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(a){return e[7]!==void 0?d.nativeOperation(b("LSFlushDataTrace.nop"),e[7]):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[14]=a[0],a})},function(a){return e[14]?e[15]=!0:e[15]=!1,e[15]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[17]=d.createArray(),void 0!==void 0?e[18]=(e[17].push(void 0),e[17]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[17],d.i64.cast([0,3]))):d.resolve()}]):d.sequence([function(a){return e[7]!==void 0?d.sequence([function(a){return e[7]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),e[7],d.i64.cast([0,85]),d.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsFetchBackupsMetadataStoredProcedure] ","",""].join(""),void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[15]=a[0],a})},function(a){return e[15]?e[16]=!0:e[16]=!1,e[16]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[17]=d.createArray(),void 0!==void 0?e[18]=(e[17].push(void 0),e[17]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[17],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(a){return e[7]!==void 0?d.nativeOperation(b("LSFlushDataTrace.nop"),e[7]):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[13]=a[0],a})},function(a){return e[13]?e[14]=!0:e[14]=!1,e[14]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[15]=d.createArray(),void 0!==void 0?e[16]=(e[15].push(void 0),e[15]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[15],d.i64.cast([0,3]))):d.resolve()}])},function(a){return d.forEach(d.db.table(196).fetch(),function(a){return a["delete"]()})},function(a){return d.forEach(d.filter(d.db.table(196).fetch([[[d.i64.cast([-1,4294967295])]]]),function(a){return d.i64.eq(a.backupId,d.i64.cast([-1,4294967295]))&&d.i64.lt(a.authorityLevel,d.i64.cast([0,80]))}),function(a){return a["delete"]()})},function(a){return d.db.table(196).add({backupId:d.i64.cast([-1,4294967295]),authorityLevel:d.i64.cast([0,80]),backupSize:d.i64.cast([-1,4294967295]),creationTime:d.i64.cast([-1,4294967295]),lastSyncTime:d.i64.cast([-1,4294967295])})}])}]):d.resolve(function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFetchBackupsMetadataStoredProcedure] is_backup_metadata_enabled is disabled"))},function(a){return e[1]=d.i64.of_float(Date.now()),e[2]=d.i64.random(),e[4]="Finishing execution. Execution time: ",e[5]=d.i64.to_string(d.i64.sub(e[1],e[0])),e[6]=" ms",e[3]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsFetchBackupsMetadataStoredProcedure] ",e[3],e[4],e[3],e[5],e[3],e[6]].join("")),d.i64.eq(d.i64.mod_(e[2],d.i64.cast([0,100])),d.i64.cast([0,0]))?(e[7]=",",e[8]=d.createArray(),void 0!==void 0?e[9]=(e[8].push(void 0),e[8]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFetchBackupsMetadataStoredProcedure",[e[4],e[7],e[5],e[7],e[6]].join(""),e[8],d.i64.cast([0,4]))):d.resolve()}])},function(a){return d.resolve(f)}])}d=a;g["default"]=d}),98);
__d("LSFetchBackupsMetadataStoredProcedure",["LSFetchBackupsMetadata","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){b===void 0&&(b={});var d=[];d[0]=b.traceId;return c("LSFetchBackupsMetadata").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("MWEncryptedBackupsFetchBackupMetadata",["LSFactory","LSFetchBackupsMetadataStoredProcedure"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a.runInTransaction(function(a){return c("LSFetchBackupsMetadataStoredProcedure")(c("LSFactory")(a))},"readwrite")}g.fetchBackupMetadata=a}),98);
__d("MWChatEncryptedBackupsAppFacebookconSmall.react",["ix","MWXIcon.react","cr:1376","fbicon","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(){var a=b("cr:1376")!=null?new(b("cr:1376"))(h("391025"),16,16):d("fbicon")._(h("869051"),20);return j.jsx(c("MWXIcon.react"),{icon:a,size:20})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWChatEncryptedBackupsAppMessengerIconSmall.react",["MWXIconAppMessenger","MWXIconStrict.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(){return i.jsx(c("MWXIconStrict.react"),{icon:c("MWXIconAppMessenger"),size:20})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWPakeQPLEvents",["qpl"],(function(a,b,c,d,e,f,g){"use strict";a=c("qpl")._(231349365,"1751");g.pakeInitiatorQplEvent=a}),98);
__d("PAKEDecryptSecretSprocStatusEnum",[],(function(a,b,c,d,e,f){a=Object.freeze({SUCCESS:0,WRONG_KEYS:-1,FAILURE:-2});f["default"]=a}),66);
__d("PAKEGetActiveSessionSprocStatusEnum",[],(function(a,b,c,d,e,f){a=Object.freeze({SUCCESS:0,NO_SESSION:-1,FAILURE:-2});f["default"]=a}),66);
__d("PAKEMessageTypeEnum",[],(function(a,b,c,d,e,f){a=Object.freeze({AWAITING_CLIENT:0,PAKE_MESSAGE_1:1,PAKE_MESSAGE_2_AND_SECRET:2,SESSION_EXPIRED_ERROR:3,MAX_ATTEMPTS_ERROR:4,GENERIC_ERROR:5,MESSAGE_SENT_ERROR:6,PREVIOUS_MESSAGE_MISSING_ERROR:7,INVALID_PREVIOUS_MESSAGE_ERROR:8,ENCRYPTION_ERROR:9,DECRYPTION_ERROR:10,CPACE_STEP_2_ERROR:11,FETCH_SECRETS_ERROR:12,CPACE_STEP_1_ERROR:13,CPACE_STEP_3_ERROR:14,PAKE_HANDSHAKE_SUCCESS:15,SERIALIZATION_ERROR:16,NO_ACTIVE_SESSION:17,MULTIPLE_ACTIVE_SESSIONS_ERROR:18,PROCESS_SECRETS_ERROR:19,TIMEOUT_ERROR:20,FLOW_ABANDONED_ERROR:21,DESERIALIZE_SECRETS_ERROR:22});f["default"]=a}),66);
__d("establishPakeHandshakeAsInitiator",["Base64Utils","FBLogger","I64","MWEncryptedBackupsDeviceRegistrationId","MWPakeQPLEvents","PAKECleanupSessionReasonEnum","PAKEDecryptSecretSprocStatusEnum","PAKEGetActiveSessionSprocStatusEnum","PAKEMessageTypeEnum","PakeCpaceUtils","PakeCpaceWasm","PakeQplLogging","QPLUserFlow","ReQL","asyncToGeneratorRuntime","clearTimeout","promiseDone","requireDeferred","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("CleanupPakeSession").__setRef("establishPakeHandshakeAsInitiator"),j=c("requireDeferred")("PakeInitiatorSprocCalls").__setRef("establishPakeHandshakeAsInitiator"),k=(h||(h=d("I64"))).of_int32(-1),l=3e3,m="PAKE_INITIATOR_FAILURE";function a(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.clientType,e=a.onGeneralFailure,f=a.onMaxAttemptsReached,g=a.onNoSessionExists,n=a.onSessionExpired,o=a.onSuccessfulSecretDecryption,p=a.onWrongOtc,q=a.otc,r=a.pakeCpaceModule,s=a.storage,t=a.timeout,u=function(){},v=function(){z&&c("clearTimeout")(z)},w=d("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();if(w===""){d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}});return{pakeClient:null,stopTimeout:v,unsubFromMessagesTable:u}}var x=(a=r)!=null?a:yield d("PakeCpaceWasm").PakeCPaceWasm(),y=x.createCPaceClient(w),z=null,A=null,B=!1,C=d("ReQL").fromTableAscending(s.table("pake_messages")),D=function(){z&&c("clearTimeout")(z),z=c("setTimeout")(function(){e(),u(),i.onReady(function(a){c("promiseDone")(a({cleanupReason:c("PAKECleanupSessionReasonEnum").TIMEOUT,clientType:b,deviceId:w,storage:s}))}),c("FBLogger")("labyrinth_web").mustfix("PAKE handshake failed by timeout")},t)},E=function(){A&&c("clearTimeout")(A),A=c("setTimeout")(function(){c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_CPACE_RETRY_JOIN_SESSION"),B=!0,M()},l)},F=function(a){var d=a.messageType,f=a.sessionId;e();j.onReady(function(a){c("promiseDone")(a.sendPakeMessage({clientType:b,messageType:d,senderId:w,sessionId:f,storage:s}))})},G=function(a){var e=a.messagePayload,f=a.responderId,g=a.sessionId;c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_CPACE_STEP_THREE_START");if(e==null){c("FBLogger")("labyrinth_web").mustfix("PAKE: When executing step 3 of CPace Handshake messagePayload was null");d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").INVALID_PREVIOUS_MESSAGE_ERROR}});return}if(f==null){c("FBLogger")("labyrinth_web").mustfix("PAKE: When executing step 3 of CPace Handshake responderId was null");d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").INVALID_PREVIOUS_MESSAGE_ERROR}});return}a=d("Base64Utils").toArrayBuffer(e);var i;try{f=x.clientFinalize(y,new Uint8Array(a));i=f.clientKey1}catch(a){F({messageType:c("PAKEMessageTypeEnum").CPACE_STEP_3_ERROR,sessionId:g});d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").CPACE_STEP_3_ERROR}});throw c("FBLogger")("labyrinth_web").mustfixThrow("PAKE: Error executing CPace step 3")}c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_DECRYPT_SECRET_START");j.onReady(function(a){c("promiseDone")(a.decryptPakeSecret({clientType:b,encryptionKey:d("PakeCpaceUtils").typedArrayToBuffer(i),sessionId:g,storage:s}),function(e){var f=e[0];e=e[1];v();switch((h||(h=d("I64"))).to_int32(e)){case c("PAKEDecryptSecretSprocStatusEnum").SUCCESS:if(f==null){d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}});throw c("FBLogger")("labyrinth_web").mustfixThrow("PAKE: decryptedSecret is null despite SPROC success")}c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_DECRYPT_SECRET_END");c("promiseDone")(a.sendPakeMessage({clientType:b,messageType:c("PAKEMessageTypeEnum").PAKE_HANDSHAKE_SUCCESS,senderId:w,sessionId:g,storage:s}));o({decryptedSecret:f,initiatorId:w});break;case c("PAKEDecryptSecretSprocStatusEnum").WRONG_KEYS:d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!0}});p();break;case c("PAKEDecryptSecretSprocStatusEnum").FAILURE:d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1}});F({messageType:c("PAKEMessageTypeEnum").DECRYPTION_ERROR,sessionId:g});break}},function(a){d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1},string:{exceptionMessage:a}}),F({messageType:c("PAKEMessageTypeEnum").DECRYPTION_ERROR,sessionId:g})})})},H=function(a){var b=a.annotations,e=a.fbLoggerMessage,f=a.messageType,g=a.onFinish;a=a.unsubFromTable;v();a();g();e!=null&&c("FBLogger")("labyrinth_web").mustfix(e,f);d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,b)},I=function(a){var b=a.onPakeStepOneSuccess;u=C.subscribe(function(a,f){if(f.operation!=="put"&&f.operation!=="add")return;a=f.value;f=(h||(h=d("I64"))).to_int32(a.messageType);switch(f){case c("PAKEMessageTypeEnum").PAKE_MESSAGE_1:c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_SEND_PAKE_MESSAGE_ONE_END");u();b();break;case c("PAKEMessageTypeEnum").INVALID_PREVIOUS_MESSAGE_ERROR:case c("PAKEMessageTypeEnum").PREVIOUS_MESSAGE_MISSING_ERROR:return H({annotations:{bool:{isUserError:!1},"int":{errorCode:f}},fbLoggerMessage:"PAKE: Failed to send PAKE message one due to invalid state",messageType:f,onFinish:function(){return e()},unsubFromTable:function(){u()}});case c("PAKEMessageTypeEnum").MESSAGE_SENT_ERROR:return H({annotations:{bool:{isUserError:!1},"int":{errorCode:f}},fbLoggerMessage:"PAKE: Failed to send PAKE message one",messageType:f,onFinish:function(){return e()},unsubFromTable:function(){u()}});default:break}})},J=function(a){var b=a.sessionId;u=C.subscribe(function(a,g){if(g.operation!=="put"&&g.operation!=="add")return;a=g.value;g=(h||(h=d("I64"))).to_int32(a.messageType);switch(g){case c("PAKEMessageTypeEnum").PAKE_MESSAGE_2_AND_SECRET:u();G({messagePayload:a.messagePayload,responderId:a.responderId,sessionId:b});break;case c("PAKEMessageTypeEnum").MAX_ATTEMPTS_ERROR:return H({annotations:{bool:{isUserError:!0},"int":{errorCode:g}},messageType:g,onFinish:function(){return f()},unsubFromTable:function(){u()}});case c("PAKEMessageTypeEnum").SESSION_EXPIRED_ERROR:return H({annotations:{bool:{isUserError:!0},"int":{errorCode:g}},messageType:g,onFinish:function(){return n()},unsubFromTable:function(){u()}});case c("PAKEMessageTypeEnum").GENERIC_ERROR:return H({annotations:{bool:{isUserError:!1},"int":{errorCode:g}},fbLoggerMessage:"PAKE: Something went wrong in the responder device",messageType:g,onFinish:function(){return e()},unsubFromTable:function(){u()}});case c("PAKEMessageTypeEnum").FETCH_SECRETS_ERROR:return H({annotations:{bool:{isUserError:!1},"int":{errorCode:g}},fbLoggerMessage:"PAKE: Responder device failed to fetch secrets.",messageType:g,onFinish:function(){return e()},unsubFromTable:function(){u()}});case c("PAKEMessageTypeEnum").FLOW_ABANDONED_ERROR:return H({annotations:{bool:{isUserError:!1},"int":{errorCode:g}},fbLoggerMessage:"PAKE: Responder device flow was abandoned.",messageType:g,onFinish:function(){return e()},unsubFromTable:function(){u()}});default:return H({annotations:{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}},fbLoggerMessage:"PAKE: Unexpected Message Type when listening for pake step two success "+g,messageType:g,onFinish:function(){return e()},unsubFromTable:function(){u()}})}})},K=function(a){var f=a.onJoinSessionSuccess;c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_GET_ACTIVE_SESSION_START");j.onReady(function(a){c("promiseDone")(a.joinPakeSession({clientType:b,initiatorId:w,storage:s}),function(a){var b=a[0],i=a[1];a=a[2];i=(i=i)!=null?i:k;switch((h||(h=d("I64"))).to_int32(b)){case c("PAKEGetActiveSessionSprocStatusEnum").SUCCESS:if(a==null||i===k){c("FBLogger")("labyrinth_web").mustfix("PAKE: When joining session, responderId or joinedSessionId were unexpectedly null");d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}});e();return}f(a,i);c("QPLUserFlow").addAnnotations(d("MWPakeQPLEvents").pakeInitiatorQplEvent,{string:{session_id:(h||(h=d("I64"))).to_string(i)}});break;case c("PAKEGetActiveSessionSprocStatusEnum").NO_SESSION:if(B===!1){E();return}d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!0},"int":{errorCode:c("PAKEMessageTypeEnum").NO_ACTIVE_SESSION}});g();v();break;case c("PAKEGetActiveSessionSprocStatusEnum").FAILURE:d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}});c("FBLogger")("labyrinth_web").mustfix("PAKE: When joining session, sproc failed");e();v();break}},function(){d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}}),c("FBLogger")("labyrinth_web").mustfix("PAKE: When joining session, sproc failed"),e(),v()})})},L=function(a){var e=a.responderId,f=a.sessionId,g;c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_CPACE_STEP_ONE_START");try{g=x.clientBegin(y,q,e)}catch(a){F({messageType:c("PAKEMessageTypeEnum").CPACE_STEP_1_ERROR,sessionId:f});d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,m,{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").CPACE_STEP_1_ERROR}});throw c("FBLogger")("labyrinth_web").mustfixThrow("PAKE: Error executing CPace step 1")}c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_SEND_MESSAGE_ONE_START");j.onReady(function(a){a.sendPakeMessageOne({clientType:b,initiatorId:w,messagePayload:d("PakeCpaceUtils").typedArrayToBuffer(g),sessionId:f,storage:s})});I({onPakeStepOneSuccess:function(){J({sessionId:f})}})},M=function(){D();d("PakeQplLogging").startPakeQPLFlow(d("MWPakeQPLEvents").pakeInitiatorQplEvent);K({onJoinSessionSuccess:function(a,b){L({responderId:a,sessionId:b})}});return{pakeClient:y,stopTimeout:v,unsubFromMessagesTable:u}};return M()});return n.apply(this,arguments)}g["default"]=a}),98);
__d("MWEncryptedBackupsEligibleDeviceCell.react",["I64","MWChatEncryptedBackupsAddonIcon.react","MWChatEncryptedBackupsAppFacebookconSmall.react","MWChatEncryptedBackupsAppMessengerIconSmall.react","MWXListCell.react","MWXText.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||d("react"),k=[6628568379,173847642670370,350685531728];function a(a){var b=a.deviceAppId,e=a.deviceManufacturer,f=a.deviceModel;a=a.eligibleDeviceCellId;b=(a=b!=null&&k.includes((i||(i=d("I64"))).to_int32(b)))!=null?a:!1;return j.jsx(c("MWXListCell.react"),{addOnStart:j.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:b?j.jsx(c("MWChatEncryptedBackupsAppFacebookconSmall.react"),{}):j.jsx(c("MWChatEncryptedBackupsAppMessengerIconSmall.react"),{})}),addOnStartVerticalAlign:"center",content:j.jsx(c("MWXText.react"),{type:"headline4",children:e+" "+f}),size:"large",testid:void 0})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("LSSendOTCNotifications",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return c.forEach(c.db.table(285).fetch(),function(a){return a["delete"]()})},function(a){return c.forEach(c.filter(c.db.table(285).fetch([[[c.i64.cast([0,1])]]]),function(a){return c.i64.eq(a.pk,c.i64.cast([0,1]))&&c.i64.lt(a.authorityLevel,c.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(a){return c.db.table(285).add({pk:c.i64.cast([0,1]),notificationSendingStatus:c.i64.cast([0,2]),authorityLevel:c.i64.cast([0,20])})},function(e){return d[0]=new c.Map(),d[0].set("device_ids",a[0]),d[1]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTask"),"meb_send_otc_notifications",c.i64.cast([0,50032]),d[1],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSSendOTCNotificationsStoredProcedure",["LSSendOTCNotifications","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.deviceIds;return c("LSSendOTCNotifications").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("MWEncryptedBackupsOTCShowNotificationSentToast",["fbt","ix","MWChatEncryptedBackupsQPLEvents","QPLUserFlow","SVGIcon","cr:4027","cr:6570","fbicon","mwPushToast","react"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=j||d("react");function a(){var a=b("cr:6570")?k.jsx(b("cr:6570"),{icon:d("fbicon")._(i("477815"),24)}):void 0,e=b("cr:4027")?d("SVGIcon").svgIcon(b("cr:4027")):void 0;d("mwPushToast").mwPushToast({body:h._("__JHASH__jo46UlZ-CxV__JHASH__"),icon:{comet:a,mds:e},testid:"mw-chat-encrypted-backups-otc-notification-sent-successful-toast"});c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_NOTIFICATION_SENT_SUCCESSFUL_TOAST")}g.showOTCNotificationSentToast=a}),226);
__d("MWEncrypedBackupsSendOTCNotifications",["FBLogger","I64","LSAuthorityLevel","LSEncryptedBackupsOpStatus","LSFactory","LSSendOTCNotificationsStoredProcedure","LSVec","MWEncryptedBackupsOTCShowNotificationSentToast","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.db,e=a.onFailure,f=a.onStart,g=a.onSuccess,i=a.onTableUnsubscribe;a=a.otcEligibleDevices;var j=function(a){return b.runInTransaction(function(b){return c("LSSendOTCNotificationsStoredProcedure")(c("LSFactory")(b),{deviceIds:c("LSVec").ofArray(a)})},"readwrite")},k=[];a.map(function(a){return k.push(a.deviceId)});f==null?void 0:f();yield j(k);a=d("ReQL").fromTableAscending(b.tables.encrypted_backups_otc_notification_sending_status);var l=a.subscribe(function(a,b){if(b.operation==="delete")return;a=b.value;if(a==null)return;b=(h||(h=d("I64"))).to_int32(a.authorityLevel);if(b!==c("LSAuthorityLevel").AUTHORITATIVE)return;l();i==null?void 0:i();switch((h||(h=d("I64"))).to_int32(a.notificationSendingStatus)){case c("LSEncryptedBackupsOpStatus").SUCCESS:d("MWEncryptedBackupsOTCShowNotificationSentToast").showOTCNotificationSentToast();g==null?void 0:g();break;case c("LSEncryptedBackupsOpStatus").FAILURE:e();break;case c("LSEncryptedBackupsOpStatus").UNKNOWN:c("FBLogger")("labyrinth_web").mustfix("OTC: Unexpected UNKNOWN status type for notification sending result.");break;default:c("FBLogger")("labyrinth_web").mustfix("OTC: Unexpected UNKNOWN status type for notification sending result.");break}});return l});return i.apply(this,arguments)}g.sendOTCNotifications=a}),98);
__d("MWEncryptedBackupsViewAllOtcEligibleDialogStep.react",["fbt","CometScrollableArea.react","FBLogger","FDSListCellGlimmer.react","MWChatEncryptedBackupsQPLEvents","MWEncrypedBackupsSendOTCNotifications","MWEncryptedBackupsEligibleDeviceCell.react","MWEncryptedBackupsOTCEligibleDevicesContext.react","MWXColumn.react","MWXColumnItem.react","MWXDialogPageLegacy.react","MWXMultiStepDialogHeader.react","MWXText.react","QPLUserFlow","gkx","promiseDone","react","useReStore","useVisibilityObserver"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react"));b=j;var l=b.useContext,m=b.useEffect,n=b.useRef,o=b.useState,p=c("gkx")("23219"),q="https://www.facebook.com/help/messenger-app/431055522328649?ref=learn_more",r={cellsScrollableAreaFds:{marginStart:"x1mh8g0r",marginLeft:null,marginRight:null,maxHeight:"xwazeda",paddingBottom:"x10b6aqq",width:"xh8yej3",$$css:!0},cellsScrollableAreaMds:{marginStart:"x1hk0nng",marginLeft:null,marginRight:null,maxHeight:"x8vp032",width:"xh8yej3",$$css:!0}};function a(a){var b=a.onFetchOtcEligibleDevicesError,e=a.onResendCodeFailure,f=a.onReturn;a=c("useVisibilityObserver")({onVisible:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_VIEW_ALL_DEVICES_SCREEN")}});var g=(i||(i=c("useReStore")))(),j=n(!1),s=n(function(){}),t=o(!1),u=t[0],v=t[1];t=l(d("MWEncryptedBackupsOTCEligibleDevicesContext.react").MWEncryptedBackupsOTCEligibleDevicesContext);var w=t.failedToFetchOtcDevices,x=t.isFetchOtcDevicesInFlight;t=t.otcEligibleDevices;var y=x?null:t.length;m(function(){(y===0||w)&&j.current===!1&&(j.current=!0,f(),b())},[w,y,b,f]);m(function(){return function(){s.current()}},[]);return k.jsxs(k.Fragment,{children:[k.jsx(c("MWXMultiStepDialogHeader.react"),{title:h._("__JHASH__MFhuz6OB9p3__JHASH__"),withCloseButton:!1,withoutBackButton:!0}),k.jsx(c("MWXDialogPageLegacy.react"),{callToActionGroupLayout:"expanded",primaryCallToAction:{label:h._("__JHASH__rgoYqsLs8Qq__JHASH__"),loading:u,onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_RESEND_CODE_CLICK"),c("promiseDone")(d("MWEncrypedBackupsSendOTCNotifications").sendOTCNotifications({db:g,onFailure:function(){v(!1),f(),e()},onStart:function(){v(!0)},onSuccess:function(){v(!1),f()},otcEligibleDevices:[]}),function(a){s.current=a},function(){c("FBLogger")("labyrinth_web").mustfix("OTC: Send otc notifications sproc failed."),f(),e()})}},ref:a,secondaryCallToAction:{label:h._("__JHASH__kVQyhECs96C__JHASH__"),linkProps:{target:"_blank",url:q},onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_CANT_ACCESS_CODE_CLICK")}},children:k.jsxs(c("MWXColumn.react"),{align:"center",paddingHorizontal:0,paddingVertical:0,spacing:16,children:[k.jsx(c("MWXColumnItem.react"),{align:"start",children:k.jsx("div",{className:"x977yut xyamay9",children:k.jsx(c("MWXText.react"),{color:"secondary",type:"body3",children:h._("__JHASH__t7U8UIKqWo9__JHASH__")})})}),k.jsx(c("MWXColumnItem.react"),{align:"start",children:x?k.jsx("div",{className:"x889kno x65xoit",children:k.jsx(c("FDSListCellGlimmer.react"),{imageStyle:"circle",paddingHorizontal:0})}):k.jsx(c("CometScrollableArea.react"),{horizontal:!1,xstyle:p?r.cellsScrollableAreaMds:r.cellsScrollableAreaFds,children:k.jsx(c("MWXColumn.react"),{align:"center",paddingHorizontal:0,paddingVertical:0,spacing:0,children:t.map(function(a,b){var d=a.appId,e=a.deviceId,f=a.manufacturer;a=a.model;return a!=null&&f!=null?k.jsx(c("MWXColumnItem.react"),{align:"start",children:k.jsx(c("MWEncryptedBackupsEligibleDeviceCell.react"),{deviceAppId:d,deviceManufacturer:f,deviceModel:a,eligibleDeviceCellId:"mw-chat-encrypted-backups-eligible-otc-device-"+b})},e):null})})})})]})})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("PAKEMessageQplLoggingAction",[],(function(a,b,c,d,e,f){a=Object.freeze({ADD_MARKER:0,END_SUCCESS:1,END_FAILURE:2,ADD_ERROR_ANNOTATION:3});f["default"]=a}),66);
__d("LSQplInteractionHelper.nop",["FBLogger","I64","MWPakeQPLEvents","PAKEMessageQplLoggingAction","Promise","QPLUserFlow"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a,e,f,g,j){a=(i||(i=d("I64"))).to_int32(g);switch(a){case c("PAKEMessageQplLoggingAction").ADD_MARKER:f==null?c("FBLogger")("labyrinth_web").mustfix("PAKE: markerName is null when adding DS PAKE marker."):c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,f);break;case c("PAKEMessageQplLoggingAction").END_FAILURE:f==null?c("FBLogger")("labyrinth_web").mustfix("PAKE: markerName is null when adding failure DS PAKE marker."):c("QPLUserFlow").endFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,f);break;case c("PAKEMessageQplLoggingAction").END_SUCCESS:c("QPLUserFlow").endSuccess(d("MWPakeQPLEvents").pakeInitiatorQplEvent);break;case c("PAKEMessageQplLoggingAction").ADD_ERROR_ANNOTATION:j==null?c("FBLogger")("labyrinth_web").mustfix("PAKE: pakeMessageType is null when annotating PAKE error."):c("QPLUserFlow").addAnnotations(d("MWPakeQPLEvents").pakeInitiatorQplEvent,{"int":{errorCode:(i||(i=d("I64"))).to_int32(j)}});break}return(h||(h=b("Promise"))).resolve()};g["default"]=a}),98);
__d("LSDecryptPakeSecret",["LSLogMebClientEvent.nop","LSQplInteractionHelper.nop","LSSymmetricEncryptionCreateDecryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptPakeSecret] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_NO_SESSION_ONGOING_FAILURE",c.i64.cast([0,0]),void 0)},function(a){return d[12]="PAKE: Failed to decrypt PAKE secrets as no session was ongoing.",c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,7]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,7]),clientType:a[2]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,7])})}))})},function(a){return function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSPakeMessagesDecryptPakeSecretStoredProcedure] ","",d[12]].join("")),d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSPakeMessagesDecryptPakeSecretStoredProcedure",[d[12]].join(""),d[13],c.i64.cast([0,3]))},function(a){return a=[void 0,c.i64.cast([-1,4294967294])],d[2]=a[0],d[3]=a[1],a}]):(f=e.item,c.sequence([function(e){return d[13]=f.responderId,d[14]=f.initiatorId,d[15]=f.pakeSecret,d[13]!==void 0?c.sequence([function(e){return d[14]!==void 0?c.sequence([function(e){return d[15]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_GENERATE_PAKE_AAD_START",c.i64.cast([0,0]),void 0)},function(a){return d[20]="_",c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_NATIVE_OP_START",c.i64.cast([0,0]),void 0)},function(e){return c.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),a[1],c.blobs.of_string(["v1",d[20],c.i64.to_string(a[0]),d[20],d[13],d[20],d[14],d[20],c.i64.to_string(f.clientType)].join("")),d[15]).then(function(a){return a=a,d[21]=a[0],a})},function(e){return d[21]!==void 0?c.resolve((e=[d[21],c.i64.cast([0,0])],d[22]=e[0],d[23]=e[1],e)):c.sequence([function(a){return d[25]="PAKE: Failed to decrypt PAKE secrets as key was incorrect.",c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,10]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,10]),clientType:a[2]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,10])})}))})},function(a){return function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSPakeMessagesDecryptPakeSecretStoredProcedure] ","",d[25]].join("")),d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSPakeMessagesDecryptPakeSecretStoredProcedure",[d[25]].join(""),d[26],c.i64.cast([0,3]))},function(a){return a=[void 0,c.i64.cast([-1,4294967295])],d[22]=a[0],d[23]=a[1],a}])},function(a){return a=[d[22],d[23]],d[18]=a[0],d[19]=a[1],a}]):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_PAKE_SECRET_NULL_FAILURE",c.i64.cast([0,0]),void 0)},function(a){return d[21]="PAKE: Failed to decrypt PAKE secrets as there was no secret to decrypt.",c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,8]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,8]),clientType:a[2]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,8])})}))})},function(a){return function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSPakeMessagesDecryptPakeSecretStoredProcedure] ","",d[21]].join("")),d[22]=c.createArray(),void 0!==void 0?d[23]=(d[22].push(void 0),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSPakeMessagesDecryptPakeSecretStoredProcedure",[d[21]].join(""),d[22],c.i64.cast([0,3]))},function(a){return a=[void 0,c.i64.cast([-1,4294967294])],d[18]=a[0],d[19]=a[1],a}])},function(a){return a=[d[18],d[19]],d[16]=a[0],d[17]=a[1],a}]):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_INITIATOR_ID_NULL_FAILURE",c.i64.cast([0,0]),void 0)},function(a){return d[19]="PAKE: Failed to decrypt PAKE secrets as initiator id was null.",c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,8]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,8]),clientType:a[2]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,8])})}))})},function(a){return function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSPakeMessagesDecryptPakeSecretStoredProcedure] ","",d[19]].join("")),d[20]=c.createArray(),void 0!==void 0?d[21]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSPakeMessagesDecryptPakeSecretStoredProcedure",[d[19]].join(""),d[20],c.i64.cast([0,3]))},function(a){return a=[void 0,c.i64.cast([-1,4294967294])],d[16]=a[0],d[17]=a[1],a}])},function(a){return a=[d[16],d[17]],d[11]=a[0],d[12]=a[1],a}]):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_RESPONDER_ID_NULL_FAILURE",c.i64.cast([0,0]),void 0)},function(a){return d[17]="PAKE: Failed to decrypt PAKE secrets as responder id was null.",c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,8]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,8]),clientType:a[2]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,8])})}))})},function(a){return function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSPakeMessagesDecryptPakeSecretStoredProcedure] ","",d[17]].join("")),d[18]=c.createArray(),void 0!==void 0?d[19]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSPakeMessagesDecryptPakeSecretStoredProcedure",[d[17]].join(""),d[18],c.i64.cast([0,3]))},function(a){return a=[void 0,c.i64.cast([-1,4294967294])],d[11]=a[0],d[12]=a[1],a}])},function(a){return a=[d[11],d[12]],d[2]=a[0],d[3]=a[1],a}]))})},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptPakeSecret] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptPakeSecret",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSDecryptPakeSecretStoredProcedure",["LSDecryptPakeSecret","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.sessionId;d[1]=b.encryptionKey;d[2]=b.clientType;return c("LSDecryptPakeSecret").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSGetActiveSession",["LSLogMebClientEvent.nop","LSQplInteractionHelper.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][getActiveSession] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.count(c.filter(c.db.table(258).fetch(),function(b){return c.i64.eq(b.messageType,c.i64.cast([0,0]))&&c.i64.eq(b.clientType,a[1])&&b.initiatorId===void 0||c.i64.eq(b.clientType,a[1])&&b.initiatorId===a[0]&&![c.i64.cast([0,1]),c.i64.cast([0,2]),c.i64.cast([0,3]),c.i64.cast([0,4]),c.i64.cast([0,21]),c.i64.cast([0,15])].some(function(a){return c.i64.eq(b.messageType,a)})&&c.i64.neq(b.sessionId,c.i64.cast([-1,4294967295]))})).then(function(a){return d[2]=a})},function(e){return c.i64.le(d[2],c.i64.cast([0,1]))?c.sequence([function(e){return c.filter(c.db.table(258).fetch(),function(b){return c.i64.eq(b.messageType,c.i64.cast([0,0]))&&c.i64.eq(b.clientType,a[1])&&b.initiatorId===void 0||c.i64.eq(b.clientType,a[1])&&b.initiatorId===a[0]&&![c.i64.cast([0,1]),c.i64.cast([0,2]),c.i64.cast([0,3]),c.i64.cast([0,4]),c.i64.cast([0,21]),c.i64.cast([0,15])].some(function(a){return c.i64.eq(b.messageType,a)})&&c.i64.neq(b.sessionId,c.i64.cast([-1,4294967295]))}).next().then(function(a,e){var f=a.done;a=a.value;return f?c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,17]))},function(a){return a=[c.i64.cast([-1,4294967295]),void 0,void 0],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]):(e=a.item,c.sequence([function(a){return d[19]=e.responderId,d[19]!==void 0?c.resolve((a=[c.i64.cast([0,0]),e.sessionId,d[19]],d[16]=a[0],d[17]=a[1],d[18]=a[2],a)):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_SESSION_ONGOING_RESPONDER_ID_NULL_FAILURE",c.i64.cast([0,0]),void 0)},function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,8]))},function(a){return a=[c.i64.cast([-1,4294967294]),void 0,void 0],d[16]=a[0],d[17]=a[1],d[18]=a[2],a}])},function(a){return a=[d[16],d[17],d[18]],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]))})},function(a){return a=[d[12],d[13],d[14]],d[3]=a[0],d[4]=a[1],d[5]=a[2],a}]):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,18]))},function(a){return a=[c.i64.cast([-1,4294967294]),void 0,void 0],d[3]=a[0],d[4]=a[1],d[5]=a[2],a}])},function(a){return d[6]=c.i64.of_float(Date.now()),d[7]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[6],d[0])),d[11]=" ms",d[8]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][getActiveSession] ",d[8],d[9],d[8],d[10],d[8],d[11]].join("")),c.i64.eq(c.i64.mod_(d[7],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"getActiveSession",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[3],d[4],d[5]],e[0]=a[0],e[1]=a[1],e[2]=a[2],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSGetActiveSessionStoredProcedure",["LSGetActiveSession","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.initiatorId;d[1]=b.clientType;return c("LSGetActiveSession").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSSendPakeMessageOne",["LSBase64Encode.nop","LSIssueNewTask","LSLogMebClientEvent.nop","LSQplInteractionHelper.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][sendPakeMessageOne] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.nativeOperation(b("LSBase64Encode.nop"),a[2]).then(function(a){return a=a,d[2]=a[0],a})},function(e){return c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[3])&&c.i64.eq(b.sessionId,a[0])}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,7]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[3])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,7]),clientType:a[3]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,7])})}))})}]):(f=e.item,d[10]=f.responderId,d[10]!==void 0?(d[11]=new c.Map(),d[11].set("session_id",a[0]),d[11].set("responder_id",d[10]),d[11].set("initiator_id",a[1]),d[11].set("message_payload",d[2]==null?"":d[2]),d[11].set("pake_secret",void 0),d[11].set("sender_id",a[1]),d[11].set("message_type",c.i64.cast([0,1])),d[11].set("client_type",a[3]),d[12]=c.toJSON(d[11]),c.storedProcedure(b("LSIssueNewTask"),"PakeMessages",c.i64.cast([0,717]),d[12],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,8]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[3])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,8]),clientType:a[3]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,8])})}))})}]))})},function(a){return d[4]=c.i64.of_float(Date.now()),d[5]=c.i64.random(),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[4],d[0])),d[9]=" ms",d[6]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][sendPakeMessageOne] ",d[6],d[7],d[6],d[8],d[6],d[9]].join("")),c.i64.eq(c.i64.mod_(d[5],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[10]=",",d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"sendPakeMessageOne",[d[7],d[10],d[8],d[10],d[9]].join(""),d[11],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSSendPakeMessageOneStoredProcedure",["LSSendPakeMessageOne","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.sessionId;d[1]=b.initiatorId;d[2]=b.messagePayload;d[3]=b.clientType;return c("LSSendPakeMessageOne").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSSendPakeMessage",["LSIssueNewTask","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][sendPakeMessage] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[4])&&c.i64.eq(b.sessionId,a[0])}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[4])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,7]),clientType:a[4]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,7])})}))}):(f=e.item,d[9]=new c.Map(),d[9].set("session_id",a[0]),d[9].set("responder_id",f.responderId),d[9].set("initiator_id",f.initiatorId),d[9].set("message_payload",a[2]==null?f.messagePayload:a[2]),d[9].set("pake_secret",f.pakeSecret),d[9].set("sender_id",a[1]),d[9].set("message_type",a[3]),d[9].set("client_type",a[4]),d[10]=c.toJSON(d[9]),c.storedProcedure(b("LSIssueNewTask"),"PakeMessages",c.i64.cast([0,717]),d[10],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0])))})},function(a){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.random(),d[6]="Finishing execution. Execution time: ",d[7]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[8]=" ms",d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][sendPakeMessage] ",d[5],d[6],d[5],d[7],d[5],d[8]].join("")),c.i64.eq(c.i64.mod_(d[4],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[9]=",",d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"sendPakeMessage",[d[6],d[9],d[7],d[9],d[8]].join(""),d[10],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSSendPakeMessageStoredProcedure",["LSSendPakeMessage","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.sessionId;d[1]=b.senderId;d[2]=b.messagePayload;d[3]=b.messageType;d[4]=b.clientType;return c("LSSendPakeMessage").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("PakeInitiatorSprocCalls",["LSDecryptPakeSecretStoredProcedure","LSFactory","LSGetActiveSessionStoredProcedure","LSIntEnum","LSSendPakeMessageOneStoredProcedure","LSSendPakeMessageStoredProcedure","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=a.clientType,e=a.initiatorId,f=a.messagePayload,g=a.sessionId;a=a.storage;c("promiseDone")(a.runInTransaction(function(a){return c("LSSendPakeMessageOneStoredProcedure")(c("LSFactory")(a),{clientType:(h||(h=d("LSIntEnum"))).ofNumber(b),initiatorId:e,messagePayload:f,sessionId:g})},"readwrite"))}function b(a){var b=a.clientType,e=a.initiatorId;a=a.storage;return a.runInTransaction(function(a){return c("LSGetActiveSessionStoredProcedure")(c("LSFactory")(a),{clientType:(h||(h=d("LSIntEnum"))).ofNumber(b),initiatorId:e})},"readwrite")}function e(a){var b=a.clientType,e=a.encryptionKey,f=a.sessionId;a=a.storage;return a.runInTransaction(function(a){return c("LSDecryptPakeSecretStoredProcedure")(c("LSFactory")(a),{clientType:(h||(h=d("LSIntEnum"))).ofNumber(b),encryptionKey:e,sessionId:f})},"readwrite")}function f(a){var b=a.clientType,e=a.messagePayload,f=a.messageType,g=a.senderId,i=a.sessionId;a=a.storage;return a.runInTransaction(function(a){return c("LSSendPakeMessageStoredProcedure")(c("LSFactory")(a),{clientType:(h||(h=d("LSIntEnum"))).ofNumber(b),messagePayload:e,messageType:h.ofNumber(f),senderId:g,sessionId:i})},"readwrite")}g.sendPakeMessageOne=a;g.joinPakeSession=b;g.decryptPakeSecret=e;g.sendPakeMessage=f}),98);
__d("LSCleanupSession",["LSIssueNewTask","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][cleanupSession] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.i64.eq(a[1],c.i64.cast([0,0]))?d[2]=c.i64.cast([0,21]):(c.i64.eq(a[1],c.i64.cast([0,1]))?d[10]=c.i64.cast([0,20]):d[10]=c.i64.cast([0,20]),d[2]=d[10]),c.filter(c.db.table(258).fetch(),function(b){return(b.initiatorId===a[0]||b.responderId===a[0])&&c.i64.eq(b.clientType,a[2])}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.filter(c.db.table(258).fetch(),function(b){return c.i64.eq(b.clientType,a[2])}).next().then(function(f,h){var e=f.done;f=f.value;return e?c.db.table(258).add({sessionId:c.i64.cast([-1,4294967295]),responderId:a[0],initiatorId:a[0],messageType:d[2],clientType:a[2]}):(h=f.item,c.sequence([function(a){return d[13]=h.sessionId,c.forEach(c.db.table(258).fetch([[[d[13]]]]),function(a){var b=a.update;a.item;return b({messageType:d[2]})})},function(e){return d[11]=new c.Map(),d[11].set("session_id",d[13]),d[11].set("responder_id",h.responderId),d[11].set("initiator_id",h.initiatorId),d[11].set("message_payload",h.messagePayload),d[11].set("pake_secret",h.pakeSecret),d[11].set("sender_id",a[0]),d[11].set("message_type",d[2]),d[11].set("client_type",a[2]),d[12]=c.toJSON(d[11]),c.storedProcedure(b("LSIssueNewTask"),"PakeMessages",c.i64.cast([0,717]),d[12],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]))}):(f=e.item,d[11]=f.sessionId,d[10]=f.messageType,c.i64.eq(d[10],c.i64.cast([0,15]))||c.i64.eq(d[10],c.i64.cast([0,21]))||c.i64.eq(d[10],c.i64.cast([0,20]))?c.resolve(0):c.sequence([function(a){return c.forEach(c.db.table(258).fetch([[[d[11]]]]),function(a){var b=a.update;a.item;return b({messageType:d[2]})})},function(e){return d[12]=new c.Map(),d[12].set("session_id",d[11]),d[12].set("responder_id",f.responderId),d[12].set("initiator_id",f.initiatorId),d[12].set("message_payload",f.messagePayload),d[12].set("pake_secret",f.pakeSecret),d[12].set("sender_id",a[0]),d[12].set("message_type",d[2]),d[12].set("client_type",a[2]),d[13]=c.toJSON(d[12]),c.storedProcedure(b("LSIssueNewTask"),"PakeMessages",c.i64.cast([0,717]),d[13],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]))})},function(a){return d[4]=c.i64.of_float(Date.now()),d[5]=c.i64.random(),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[4],d[0])),d[9]=" ms",d[6]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][cleanupSession] ",d[6],d[7],d[6],d[8],d[6],d[9]].join("")),c.i64.eq(c.i64.mod_(d[5],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[10]=",",d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"cleanupSession",[d[7],d[10],d[8],d[10],d[9]].join(""),d[11],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSCleanupSessionStoredProcedure",["LSCleanupSession","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.deviceId;d[1]=b.cleanupReason;d[2]=b.clientType;return c("LSCleanupSession").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("CleanupPakeSession",["LSCleanupSessionStoredProcedure","LSFactory","LSIntEnum","MAWOneTimeCodeGating","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var e=a.cleanupReason,f=a.clientType,g=a.deviceId;a=a.storage;return!d("MAWOneTimeCodeGating").isOneTimeCodeEnabled()?(i||(i=b("Promise"))).resolve():a.runInTransaction(function(a){return c("LSCleanupSessionStoredProcedure")(c("LSFactory")(a),{cleanupReason:(h||(h=d("LSIntEnum"))).ofNumber(e),clientType:h.ofNumber(f),deviceId:g})},"readwrite")}g["default"]=a}),98);
__d("LSFinishAddPeerDevice",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDataTrace","LSCreateDataTraceID.nop","LSCreateDebugToken.nop","LSCreateDerivedKeys.nop","LSCreateSignature_v2.nop","LSDeleteBackupOnClient","LSFlushDataTrace.nop","LSGenerateLocalKeys","LSGetBlobFromString.nop","LSGetEncryptionVersionFromSupportedVersionsList.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewTask","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Beginning execution."),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))&&c.i64.eq(a.backupTenancy,c.i64.cast([0,2]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){b=a.done;a=a.value;return b?d[1]=!1:(a.item,d[1]=!0)})},function(a){return d[1]?d[3]=c.i64.or_(c.i64.cast([0,88]),c.i64.cast([0,128])):d[3]=c.i64.cast([0,88]),c.nativeOperation(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,d[4]=a[0],a})},function(a){return d[14]="EncryptedBackups MCD Trace ID",d[15]=c.i64.to_string(d[3]),d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",d[5],d[14],d[5],d[15]].join("")),c.resolve()},function(a){return c.storedProcedure(b("LSCreateDataTrace"),d[4],void 0,void 0,"qr_add_device_receiver",d[3])},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[6]=a[0],a})},function(a){return d[6]?d[7]=!0:d[7]=!1,d[7]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[19]=c.createArray(),void 0!==void 0?d[20]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[19],c.i64.cast([0,3]))):c.resolve()},function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,1434]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[8]=a[0],a})},function(a){return d[8]?d[9]=!0:d[9]=!1,d[9]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[19]=c.createArray(),void 0!==void 0?d[20]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[19],c.i64.cast([0,3]))):c.resolve()},function(e){return c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(e,f){f=e.done;e=e.value;return f?c.sequence([function(a){return c.db.table(168).fetch().next().then(function(a,d){var e=a.done;a=a.value;return e?0:(d=a.item,c.storedProcedure(b("LSDeleteBackupOnClient"),d.backupId,void 0,!1,void 0,"null",!0))})},function(e){return d[19]=a[0].get("backup_id"),a[0],c.storedProcedure(b("LSGenerateLocalKeys"),!1).then(function(a){return a=a,d[20]=a[0],d[21]=a[1],a})},function(e){return d[20]!==void 0?c.sequence([function(a){return d[22]=d[20].get("device_key"),d[20],d[23]=d[20].get("epoch_storage_key"),d[20],d[24]=d[20].get("epoch_auth_key"),d[20],d[25]=d[22].get("device_private_key"),d[22],d[26]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[27]=a[0],a})},function(a){return d[27]?d[65]=(d[26].push(c.i64.cast([0,0])),d[26]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]?d[65]=(d[26].push(c.i64.cast([0,2])),d[26]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[65]=(d[26].push(c.i64.cast([0,3])),d[26]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[65]=(d[26].push(c.i64.cast([0,4])),d[26]):0,d[31]="",d[32]=c.i64.of_int32(d[26].length),c.i64.gt(d[32],c.i64.cast([0,0]))?c.loopAsync(d[32],function(a){return d[65]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[26],d[65]).then(function(a){return a=a,d[66]=a[0],d[67]=a[1],a})},function(a){return d[31]=[d[31],"_",c.i64.to_string(d[66])].join("")}])}):c.resolve()},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),["supported_versions_",d[31],"revision_version_",c.i64.to_string(c.i64.cast([0,1]))].join("")).then(function(a){return a=a,d[33]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateSignature_v2.nop"),d[25],c.blob("Mg=="),d[33]).then(function(a){return a=a,d[34]=a[0],a})},function(a){return c.blobs.neq(d[34],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[34]).then(function(a){return a=a,d[65]=a[0],a})},function(a){return d[35]=d[65]}]):c.resolve(d[35]=void 0)},function(a){return c.count(c.db.table(191).fetch()).then(function(a){return d[36]=a})},function(a){return c.i64.neq(d[36],c.i64.cast([0,0]))?c.sequence([function(a){return d[65]=c.createArray(),c.forEach(c.filter(c.db.table(191).fetch(),function(a){return c.i64.eq(d[19],a.backupId)}),function(a){var e=a.item;return c.sequence([function(a){return d[75]=c.createArray(),c.forEach(c.db.table(192).fetch([[[e.deviceId]]]),function(a){var e=a.item;return c.sequence([function(a){return d[78]=e.supportedVersion,c.storedProcedure(b("LSIsEncryptionVersionSecure"),d[78]).then(function(a){return a=a,d[77]=a[0],a})},function(a){return d[77]?d[79]=(d[75].push(d[78]),d[75]):0}])})},function(a){return d[76]=c.i64.of_int32(d[75].length),c.i64.gt(d[76],c.i64.cast([0,0]))?d[77]=(d[65].push(d[75]),d[65]):0}])})},function(a){return d[66]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[67]=a[0],a})},function(a){return d[67]?d[75]=(d[66].push(c.i64.cast([0,0])),d[66]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[68]=a[0],a})},function(a){return d[68]?d[75]=(d[66].push(c.i64.cast([0,2])),d[66]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[69]=a[0],a})},function(a){return d[69]?d[75]=(d[66].push(c.i64.cast([0,3])),d[66]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[70]=a[0],a})},function(a){return d[70]?d[75]=(d[66].push(c.i64.cast([0,4])),d[66]):0,d[71]=c.createArray(),d[72]=c.i64.of_int32(d[66].length),c.i64.gt(d[72],c.i64.cast([0,0]))?c.loopAsync(d[72],function(a){return d[75]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[66],d[75]).then(function(a){return a=a,d[76]=a[0],d[77]=a[1],a})},function(a){return d[78]=(d[71].push(d[76]),d[71])}])}):c.resolve()},function(a){return d[75]=(d[65].push(d[71]),d[65]),c.nativeOperation(b("LSGetEncryptionVersionFromSupportedVersionsList.nop"),d[65]).then(function(a){return a=a,d[73]=a[0],a})},function(a){return c.i64.neq(void 0,void 0)?c.resolve(d[74]=void 0):c.sequence([function(a){return d[75]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[76]=a[0],a})},function(a){return d[76]?d[85]=(d[75].push(c.i64.cast([0,0])),d[75]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[77]=a[0],a})},function(a){return d[77]?d[85]=(d[75].push(c.i64.cast([0,2])),d[75]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[78]=a[0],a})},function(a){return d[78]?d[85]=(d[75].push(c.i64.cast([0,3])),d[75]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[79]=a[0],a})},function(a){return d[79]?d[85]=(d[75].push(c.i64.cast([0,4])),d[75]):0,d[80]=c.createArray(),d[81]=c.i64.of_int32(d[75].length),c.i64.gt(d[81],c.i64.cast([0,0]))?c.loopAsync(d[81],function(a){return d[85]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[75],d[85]).then(function(a){return a=a,d[86]=a[0],d[87]=a[1],a})},function(a){return d[88]=(d[80].push(d[86]),d[80])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[85]=c.createArray(),d[86]=c.i64.of_int32(d[80].length),c.i64.gt(d[86],c.i64.cast([0,0]))?c.loopAsync(d[86],function(a){return d[88]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[80],d[88]).then(function(a){return a=a,d[89]=a[0],d[90]=a[1],a})},function(a){return d[91]=(d[85].push(c.i64.to_string(d[89])),d[85])}])}):c.resolve()},function(a){return d[87]=d[85].join(","),d[82]=d[87]}])},function(a){return d[80].some(function(a){return c.i64.eq(d[73],a)})?d[83]=d[73]:d[83]=void 0,c.i64.neq(d[83],void 0)?d[84]=d[83]:d[84]=void 0,d[74]=d[84]}])},function(a){return c.i64.neq(d[74],void 0)?c.resolve(0):(d[75]=["Returning unsupported encyption version, version not supported: ",c.i64.to_string(d[73])].join(""),function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsVersioningUtils] ","",d[75]].join("")),d[76]=c.createArray(),void 0!==void 0?d[77]=(d[76].push(void 0),d[76]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsVersioningUtils",[d[75]].join(""),d[76],c.i64.cast([0,3])))},function(a){return d[37]=d[73]}]):c.sequence([function(a){return function(a){c.logger(a).warn(a)}("[EncryptedBackups][LSEncryptedBackupsVersioningUtils] Device versions table not populated when adding device using QR code"),d[65]=c.createArray(),void 0!==void 0?d[66]=(d[65].push(void 0),d[65]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsVersioningUtils","Device versions table not populated when adding device using QR code",d[65],c.i64.cast([0,2]))},function(a){return d[37]=c.i64.cast([0,0])}])},function(e){return d[38]=a[0].get("temp_ocmf_client_state"),a[0],c.nativeOperation(b("LSOcmfClientEvolve_v2.nop"),d[38]).then(function(a){return a=a,d[39]=a[0],d[40]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[40]).then(function(a){return a=a,d[41]=a[0],a})},function(b){return d[42]=d[22].get("device_public_key"),d[22],d[43]=d[22].get("device_private_key"),d[22],d[44]=d[23].get("epoch_storage_public_key"),d[23],d[45]=d[23].get("epoch_storage_private_key"),d[23],d[46]=d[24].get("epoch_auth_public_key"),d[24],d[47]=d[24].get("epoch_auth_private_key"),d[24],d[48]=a[0].get("mailbox_root_key"),a[0],d[49]=a[0].get("oblivious_validation_token"),a[0],c.forEach(c.filter(c.db.table(168).fetch([[[d[19]]]]),function(a){return c.i64.eq(a.backupId,d[19])&&c.i64.lt(a.authorityLevel,c.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(a){return c.db.table(168).add({backupId:d[19],devicePublicKeyBlob:d[42],devicePrivateKeyBlob:d[43],epochStoragePublicKeyBlob:d[44],epochStoragePrivateKeyBlob:d[45],epochAuthPublicKeyBlob:d[46],epochAuthPrivateKeyBlob:d[47],mailboxRootKeyBlob:d[48],ocmfClientStateBlob:d[39],obliviousValidationTokenBlob:d[49],authorityLevel:c.i64.cast([0,20]),backupTenancy:c.i64.cast([0,1]),revisionVersion:c.i64.cast([0,1]),encryptionVersion:d[37]})},function(a){return c.blobs.neq(d[48],void 0)?c.sequence([function(a){return d[65]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[48],"private_key",d[43],c.i64.cast([0,1]),d[65]).then(function(a){return a=a,d[66]=a[0],a})},function(a){return c.blobs.neq(d[66],void 0)?d[67]=d[66]:d[67]=void 0,d[50]=d[67]}]):c.resolve(d[50]=void 0)},function(a){return c.blobs.neq(d[50],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[50]).then(function(a){return a=a,d[65]=a[0],a})},function(a){return d[51]=d[65]}]):c.resolve(d[51]=void 0)},function(a){return c.blobs.neq(d[48],void 0)?c.sequence([function(a){return d[65]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[48],"epoch_storage_private_key",d[45],c.i64.cast([0,1]),d[65]).then(function(a){return a=a,d[66]=a[0],a})},function(a){return c.blobs.neq(d[66],void 0)?d[67]=d[66]:d[67]=void 0,d[52]=d[67]}]):c.resolve(d[52]=void 0)},function(a){return c.blobs.neq(d[52],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[52]).then(function(a){return a=a,d[65]=a[0],a})},function(a){return d[53]=d[65]}]):c.resolve(d[53]=void 0)},function(a){return c.blobs.neq(d[48],void 0)?c.sequence([function(a){return d[65]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[48],"epoch_auth_private_key",d[47],c.i64.cast([0,1]),d[65]).then(function(a){return a=a,d[66]=a[0],a})},function(a){return c.blobs.neq(d[66],void 0)?d[67]=d[66]:d[67]=void 0,d[54]=d[67]}]):c.resolve(d[54]=void 0)},function(a){return c.blobs.neq(d[54],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[54]).then(function(a){return a=a,d[65]=a[0],a})},function(a){return d[55]=d[65]}]):c.resolve(d[55]=void 0)},function(a){return d[64]=c.blob("bWFpbGJveF9yb290X2tleQ=="),c.blobs.neq(d[64],void 0)?c.sequence([function(a){return d[65]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[64],"mailbox_root_key",d[48],c.i64.cast([0,1]),d[65]).then(function(a){return a=a,d[66]=a[0],a})},function(a){return c.blobs.neq(d[66],void 0)?d[67]=d[66]:d[67]=void 0,d[56]=d[67]}]):c.resolve(d[56]=void 0)},function(a){return c.blobs.neq(d[56],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[56]).then(function(a){return a=a,d[65]=a[0],a})},function(a){return d[57]=d[65]}]):c.resolve(d[57]=void 0)},function(a){return c.blobs.neq(d[48],void 0)?c.sequence([function(a){return d[65]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[48],"ocmf_client_state",d[39],c.i64.cast([0,1]),d[65]).then(function(a){return a=a,d[66]=a[0],a})},function(a){return c.blobs.neq(d[66],void 0)?d[67]=d[66]:d[67]=void 0,d[58]=d[67]}]):c.resolve(d[58]=void 0)},function(a){return c.blobs.neq(d[58],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[58]).then(function(a){return a=a,d[65]=a[0],a})},function(a){return d[59]=d[65]}]):c.resolve(d[59]=void 0)},function(a){return c.db.table(217).put({backupId:d[19],devicePrivateKeyDebugToken:d[51]==null?"":d[51],epochStoragePrivateKeyDebugToken:d[53]==null?"":d[53],epochAuthPrivateKeyDebugToken:d[55]==null?"":d[55],mailboxRootKeyDebugToken:d[57]==null?"":d[57],ocmfClientStateDebugToken:d[59]==null?"":d[59],appVersion:""})},function(e){return d[60]=a[0].get("add_peer_epoch_data"),a[0],d[61]=c.i64.of_int32(d[60].length),c.i64.gt(d[61],c.i64.cast([0,0]))?c.loopAsync(d[61],function(a){return d[65]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[60],d[65]).then(function(a){return a=a,d[66]=a[0],d[67]=a[1],a})},function(a){return d[68]=d[66].get("epoch_id"),d[66],d[69]=d[66].get("epoch_anon_id"),d[66],d[70]=d[66].get("epoch_root_key"),d[66],d[71]=d[66].get("epoch_status"),d[66],c.forEach(c.filter(c.db.table(169).fetch([[[d[68]]]]),function(a){return c.i64.eq(a.epochId,d[68])&&c.i64.lt(a.authorityLevel,c.i64.cast([0,80]))}),function(a){return a["delete"]()})},function(a){return c.db.table(169).add({epochId:d[68],authorityLevel:c.i64.cast([0,80]),backupId:d[19],epochAnonIdBlob:d[69],epochRootKeyBlob:d[70],epochStatus:d[71]})},function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,20]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?(f=[void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,20])],d[72]=f[0],d[73]=f[1],d[74]=f[2],d[75]=f[3],d[76]=f[4],d[77]=f[5],d[78]=f[6],d[79]=f[7],d[80]=f[8],d[81]=f[9],d[82]=f[10],d[83]=f[11],d[84]=f[12],d[85]=f[13],f):(e=a.item,c.sequence([function(a){return d[91]=e.backupTenancy,d[90]=e.encryptionVersion,c.i64.neq(void 0,void 0)?c.resolve(d[87]=void 0):c.sequence([function(a){return d[92]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[93]=a[0],a})},function(a){return d[93]?d[102]=(d[92].push(c.i64.cast([0,0])),d[92]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[94]=a[0],a})},function(a){return d[94]?d[102]=(d[92].push(c.i64.cast([0,2])),d[92]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[95]=a[0],a})},function(a){return d[95]?d[102]=(d[92].push(c.i64.cast([0,3])),d[92]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[96]=a[0],a})},function(a){return d[96]?d[102]=(d[92].push(c.i64.cast([0,4])),d[92]):0,d[97]=c.createArray(),d[98]=c.i64.of_int32(d[92].length),c.i64.gt(d[98],c.i64.cast([0,0]))?c.loopAsync(d[98],function(a){return d[102]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[92],d[102]).then(function(a){return a=a,d[103]=a[0],d[104]=a[1],a})},function(a){return d[105]=(d[97].push(d[103]),d[97])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[102]=c.createArray(),d[103]=c.i64.of_int32(d[97].length),c.i64.gt(d[103],c.i64.cast([0,0]))?c.loopAsync(d[103],function(a){return d[105]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[97],d[105]).then(function(a){return a=a,d[106]=a[0],d[107]=a[1],a})},function(a){return d[108]=(d[102].push(c.i64.to_string(d[106])),d[102])}])}):c.resolve()},function(a){return d[104]=d[102].join(","),d[99]=d[104]}])},function(a){return d[97].some(function(a){return c.i64.eq(d[90],a)})?d[100]=d[90]:d[100]=void 0,c.i64.neq(d[100],void 0)?d[101]=d[100]:d[101]=void 0,d[87]=d[101]}])},function(a){return c.i64.neq(d[87],void 0)?d[88]=d[87]:d[88]=c.i64.cast([0,0]),c.i64.neq(d[91],void 0)?d[89]=d[91]:d[89]=c.i64.cast([0,1]),a=[e.backupId,e.deviceId,e.mailboxRootKeyBlob,e.ocmfClientStateBlob,d[88],d[89],e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.obliviousValidationTokenBlob,e.authorityLevel],d[72]=a[0],d[73]=a[1],d[74]=a[2],d[75]=a[3],d[76]=a[4],d[77]=a[5],d[78]=a[6],d[79]=a[7],d[80]=a[8],d[81]=a[9],d[82]=a[10],d[83]=a[11],d[84]=a[12],d[85]=a[13],a}]))})},function(a){return c.blobs.neq(d[74],void 0)?c.sequence([function(a){return c.blobs.neq(d[74],void 0)?c.sequence([function(a){return d[89]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[74],"epoch_root_key",d[70],c.i64.cast([0,1]),d[89]).then(function(a){return a=a,d[90]=a[0],a})},function(a){return c.blobs.neq(d[90],void 0)?d[91]=d[90]:d[91]=void 0,d[87]=d[91]}]):c.resolve(d[87]=void 0)},function(a){return c.blobs.neq(d[87],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[87]).then(function(a){return a=a,d[89]=a[0],a})},function(a){return d[88]=d[89]}]):c.resolve(d[88]=void 0)},function(a){return c.db.table(218).put({epochId:d[68],epochAnonId:c.blobs.to_string(d[69]),epochRootKeyDebugToken:d[88]==null?"":d[88],appVersion:""})}]):(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsEncryptedBackupsEpochDebugMetadataV2Table] mailbox_root_key is null, skipping generate epoch debug tokens"),d[87]=c.createArray(),void 0!==void 0?d[88]=(d[87].push(void 0),d[87]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsEncryptedBackupsEpochDebugMetadataV2Table","mailbox_root_key is null, skipping generate epoch debug tokens",d[87],c.i64.cast([0,3])))}])}):c.resolve()},function(a){return c.count(c.db.table(169).fetch()).then(function(a){return d[62]=a})},function(a){return c.i64.le(d[62],c.i64.cast([0,1]))?c.sequence([function(a){return c.db.table(169).fetch().next().then(function(a,e){var f=a.done;a=a.value;return f?c.sequence([function(a){return d[67]="No epoch available in epochs table",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",d[67]].join("")),d[68]=c.createArray(),void 0!==void 0?d[69]=(d[68].push(void 0),d[68]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[d[67]].join(""),d[68],c.i64.cast([0,3]))},function(a){return d[65]=void 0}]):(e=a.item,d[67]=new c.Map(),d[67].set("epoch_id",e.epochId),d[67].set("backup_id",e.backupId),d[67].set("epoch_anon_id_blob",e.epochAnonIdBlob),d[67].set("epoch_root_key_blob",e.epochRootKeyBlob),d[67].set("epoch_status",e.epochStatus),d[67].set("authority_level",e.authorityLevel),d[65]=d[67])})},function(a){return d[63]=d[65]}]):c.sequence([function(a){return d[65]="Multiple epochs available in epochs table",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",d[65]].join("")),d[66]=c.createArray(),void 0!==void 0?d[67]=(d[66].push(void 0),d[66]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[d[65]].join(""),d[66],c.i64.cast([0,3]))},function(a){return d[63]=void 0}])},function(e){return d[63]!==void 0?c.sequence([function(a){return d[65]=d[63].get("epoch_anon_id_blob"),d[63],d[66]=d[63].get("epoch_root_key_blob"),d[63],d[67]=d[22].get("device_public_key"),d[22],d[68]=c.createArray(),d[72]=(d[68].push(c.i64.cast([0,32])),d[68]),c.nativeOperation(b("LSBase64Encode.nop"),d[65]).then(function(a){return a=a,d[69]=a[0],a})},function(a){return d[69]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blobs.of_string(["epoch_devices","_",d[69]].join("")),void 0,d[66],d[68]).then(function(a){return a=a,d[72]=a[0],a})},function(a){return d[72]?d[73]=!1:d[73]=!0,d[73]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),d[75]=c.createArray(),void 0!==void 0?d[77]=(d[75].push(void 0),d[75]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils","THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",d[75],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[76]=a[0],a})},function(a){return d[74]=d[76]}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[72],c.i64.cast([0,0])).then(function(a){return a=a,d[75]=a[0],d[76]=a[1],a})},function(a){return d[74]=d[75]}])},function(a){return d[70]=d[74]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),d[72]=c.createArray(),void 0!==void 0?d[74]=(d[72].push(void 0),d[72]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils","THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",d[72],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[73]=a[0],a})},function(a){return d[70]=d[73]}])},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),d[70],d[67]).then(function(a){return a=a,d[71]=a[0],a})},function(e){return c.blobs.neq(d[71],void 0)?c.sequence([function(a){return d[72]=d[22].get("device_public_key"),d[22],c.nativeOperation(b("LSBase64Encode.nop"),d[72]).then(function(a){return a=a,d[73]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[71]).then(function(a){return a=a,d[74]=a[0],a})},function(a){return d[75]=d[63].get("epoch_root_key_blob"),d[63],c.blobs.neq(d[75],void 0)?c.sequence([function(a){return d[100]=c.createArray(),d[106]=(d[100].push(c.i64.cast([0,18])),d[100]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[75],d[100]).then(function(a){return a=a,d[101]=a[0],a})},function(a){return d[101]!==void 0?c.sequence([function(a){return d[106]=c.i64.of_int32(d[101].length),c.i64.ge(d[106],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[101],c.i64.cast([0,0])).then(function(a){return a=a,d[108]=a[0],d[109]=a[1],a})},function(a){return d[107]=d[108]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[108]=c.createArray(),void 0!==void 0?d[109]=(d[108].push(void 0),d[108]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[108],c.i64.cast([0,3]))},function(a){return d[107]=void 0}])},function(a){return d[102]=d[107]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[106]=c.createArray(),void 0!==void 0?d[107]=(d[106].push(void 0),d[106]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[106],c.i64.cast([0,3]))},function(a){return d[102]=void 0}])},function(a){return c.blobs.neq(d[102],void 0)?d[103]=!0:d[103]=!1,d[103]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSBase64Encode.nop"),d[102]).then(function(a){return a=a,d[104]=a[0],a})},function(a){return d[104]!==void 0?d[105]=d[104]:d[105]="encodingfailed",d[76]=d[105]}]):c.resolve(d[76]="null")},function(a){return d[77]=d[23].get("epoch_storage_public_key"),d[23],c.nativeOperation(b("LSBase64Encode.nop"),d[77]).then(function(a){return a=a,d[78]=a[0],a})},function(a){return d[79]=d[20].get("epoch_storage_public_key_sig"),d[20],c.nativeOperation(b("LSBase64Encode.nop"),d[79]).then(function(a){return a=a,d[80]=a[0],a})},function(a){return d[81]=d[24].get("epoch_auth_public_key"),d[24],c.nativeOperation(b("LSBase64Encode.nop"),d[81]).then(function(a){return a=a,d[82]=a[0],a})},function(a){return d[83]=d[20].get("epoch_auth_public_key_sig"),d[20],c.nativeOperation(b("LSBase64Encode.nop"),d[83]).then(function(a){return a=a,d[84]=a[0],a})},function(e){return d[85]=d[22].get("device_private_key"),d[22],d[86]=a[0].get("mailbox_root_key"),a[0],d[87]=d[23].get("epoch_storage_private_key"),d[23],c.blobs.neq(d[86],void 0)?c.sequence([function(a){return d[100]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[86],"private_key",d[85],c.i64.cast([0,1]),d[100]).then(function(a){return a=a,d[101]=a[0],a})},function(a){return c.blobs.neq(d[101],void 0)?d[102]=d[101]:d[102]=void 0,d[88]=d[102]}]):c.resolve(d[88]=void 0)},function(a){return c.blobs.neq(d[88],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[88]).then(function(a){return a=a,d[100]=a[0],a})},function(a){return d[89]=d[100]}]):c.resolve(d[89]=void 0)},function(a){return c.blobs.neq(d[86],void 0)?c.sequence([function(a){return d[100]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[86],"ocmf_client_state",d[39],c.i64.cast([0,1]),d[100]).then(function(a){return a=a,d[101]=a[0],a})},function(a){return c.blobs.neq(d[101],void 0)?d[102]=d[101]:d[102]=void 0,d[90]=d[102]}]):c.resolve(d[90]=void 0)},function(a){return c.blobs.neq(d[90],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[90]).then(function(a){return a=a,d[100]=a[0],a})},function(a){return d[91]=d[100]}]):c.resolve(d[91]=void 0)},function(a){return c.blobs.neq(d[86],void 0)?c.sequence([function(a){return d[100]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[86],"epoch_storage_private_key",d[87],c.i64.cast([0,1]),d[100]).then(function(a){return a=a,d[101]=a[0],a})},function(a){return c.blobs.neq(d[101],void 0)?d[102]=d[101]:d[102]=void 0,d[92]=d[102]}]):c.resolve(d[92]=void 0)},function(a){return c.blobs.neq(d[92],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[92]).then(function(a){return a=a,d[100]=a[0],a})},function(a){return d[93]=d[100]}]):c.resolve(d[93]=void 0)},function(e){return d[94]=a[0].get("backup_id"),a[0],d[95]=a[0].get("server_data_id"),a[0],d[96]=d[63].get("epoch_id"),d[63],d[97]=new c.Map(),d[97].set("supported_encryption_versions",d[26]),d[97].set("client_version",c.i64.cast([0,1])),d[97].set("version_sig",d[35]==null?"":d[35]),d[98]=new c.Map(),d[98].set("backup_id",d[94]),d[98].set("device_epoch_hmac",d[74]==null?"":d[74]),d[98].set("epoch_root_key_fingerprint",d[76]),d[98].set("device_public_key",d[73]==null?"":d[73]),d[98].set("epoch_auth_pubkey",d[82]==null?"":d[82]),d[98].set("epoch_auth_pubkey_sig",d[84]==null?"":d[84]),d[98].set("epoch_storage_pubkey",d[78]==null?"":d[78]),d[98].set("epoch_storage_pubkey_sig",d[80]==null?"":d[80]),d[98].set("ocmf_rotation_token",d[41]==null?"":d[41]),d[98].set("server_data_id",d[95]),d[98].set("device_registration_id",a[1]),d[98].set("base_epoch_id",d[96]),d[98].set("encryption_version_data",d[97]),d[98].set("private_key_debug_token",d[89]),d[98].set("ocmf_client_state_debug_token",d[91]),d[98].set("epoch_storage_pvtkey_debug_token",d[93]),d[98].set("trace_id",d[4]),d[98].set("occam_only_eligible",!0),d[99]=c.toJSON(d[98]),c.storedProcedure(b("LSIssueNewTask"),"encrypted_backups_setup",c.i64.cast([0,50017]),d[99],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] $device_epoch_hmac found to be null"),d[4]!==void 0?c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,85]),c.i64.cast([0,2]),"[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] $device_epoch_hmac found to be null",void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[73]=a[0],a})},function(a){return d[73]?d[74]=!0:d[74]=!1,d[74]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[75]=c.createArray(),void 0!==void 0?d[76]=(d[75].push(void 0),d[75]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[75],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[72]=c.createArray(),d[4]!==void 0?d[73]=(d[72].push(d[4]),d[72]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","$device_epoch_hmac found to be null",d[72],c.i64.cast([0,3]))},function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),d[19],"backup_init_flow",!0,d[4],void 0,!1)},function(a){return c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})}])}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Error! There should be exactly one open epoch. Deleting local state and terminating device addition"),d[4]!==void 0?c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,85]),c.i64.cast([0,2]),"[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Error! There should be exactly one open epoch. Deleting local state and terminating device addition",void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[66]=a[0],a})},function(a){return d[66]?d[67]=!0:d[67]=!1,d[67]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[68]=c.createArray(),void 0!==void 0?d[69]=(d[68].push(void 0),d[68]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[68],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[65]=c.createArray(),d[4]!==void 0?d[66]=(d[65].push(d[4]),d[65]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","Error! There should be exactly one open epoch. Deleting local state and terminating device addition",d[65],c.i64.cast([0,3]))},function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),d[19],"backup_init_flow",!0,d[4],void 0,!1)},function(a){return c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})}])}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Error! Error in generating the keys. Deleting local state and terminating device addition"),d[4]!==void 0?c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,85]),c.i64.cast([0,2]),"[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Error! Error in generating the keys. Deleting local state and terminating device addition",void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[23]?d[24]=!0:d[24]=!1,d[24]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[25]=c.createArray(),void 0!==void 0?d[26]=(d[25].push(void 0),d[25]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[25],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[22]=c.createArray(),d[4]!==void 0?d[23]=(d[22].push(d[4]),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","Error! Error in generating the keys. Deleting local state and terminating device addition",d[22],c.i64.cast([0,3]))},function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),d[19],"backup_init_flow",!0,d[4],void 0,!1)},function(a){return c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})}])}]):(e.item,d[19]="An authoritative row already exists, aborting execution of add peer device",d[19]!==void 0?c.sequence([function(a){return d[23]=["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",d[19]].join(""),function(a){c.logger(a).mustfix(a)}(d[23]),d[20]=c.createArray(),d[4]!==void 0?d[24]=(d[20].push(d[4]),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",d[19],d[20],c.i64.cast([0,3]))},function(a){return d[4]!==void 0?c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,85]),c.i64.cast([0,2]),d[23],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[25]=!0:d[25]=!1,d[25]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[26],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[22]=!0:d[22]=!1,d[22]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[24]=c.createArray(),void 0!==void 0?d[25]=(d[24].push(void 0),d[24]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[24],c.i64.cast([0,3]))):c.resolve()}]):c.sequence([function(a){return d[4]!==void 0?c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[22]?d[23]=!0:d[23]=!1,d[23]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[24]=c.createArray(),void 0!==void 0?d[25]=(d[24].push(void 0),d[24]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[24],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[21]=!0:d[21]=!1,d[21]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[22]=c.createArray(),void 0!==void 0?d[23]=(d[22].push(void 0),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[22],c.i64.cast([0,3]))):c.resolve()}]))})},function(a){return d[11]=c.i64.of_float(Date.now()),d[12]=c.i64.random(),d[16]="Finishing execution. Execution time: ",d[17]=c.i64.to_string(c.i64.sub(d[11],d[0])),d[18]=" ms",d[13]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ",d[13],d[16],d[13],d[17],d[13],d[18]].join("")),c.i64.eq(c.i64.mod_(d[12],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[19]=",",d[20]=c.createArray(),void 0!==void 0?d[21]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[d[16],d[19],d[17],d[19],d[18]].join(""),d[20],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSDeserializeSecretsAndAddDevice",["LSArrayGetObjectAt","LSBase64Decode.nop","LSDeserializeFromJsonIntoDictionaryV2.nop","LSFinishAddPeerDevice","LSQplInteractionHelper.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"MEB_DS_DESERIALIZE_SECRETS_NATIVE_OP_START",c.i64.cast([0,0]),void 0)},function(e){return c.nativeOperation(b("LSDeserializeFromJsonIntoDictionaryV2.nop"),a[0]).then(function(a){return a=a,d[0]=a[0],a})},function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"MEB_DS_DESERIALIZE_SECRETS_NATIVE_OP_END",c.i64.cast([0,0]),void 0)},function(a){return d[1]=d[0].get("temp_ocmf_client_state"),d[0],c.nativeOperation(b("LSBase64Decode.nop"),d[1]).then(function(a){return a=a,d[2]=a[0],a})},function(a){return d[3]=d[0].get("mailbox_root_key"),d[0],c.nativeOperation(b("LSBase64Decode.nop"),d[3]).then(function(a){return a=a,d[4]=a[0],a})},function(a){return d[5]=d[0].get("oblivious_validation_token"),d[0],c.nativeOperation(b("LSBase64Decode.nop"),d[5]).then(function(a){return a=a,d[6]=a[0],a})},function(a){return d[7]=c.createArray(),d[8]=d[0].get("add_peer_epoch_data_serializable"),d[0],d[9]=c.i64.of_int32(d[8].length),c.i64.gt(d[9],c.i64.cast([0,0]))?c.loopAsync(d[9],function(a){return d[14]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[8],d[14]).then(function(a){return a=a,d[15]=a[0],d[16]=a[1],a})},function(a){return d[17]=d[15].get("epoch_anon_id"),d[15],c.nativeOperation(b("LSBase64Decode.nop"),d[17]).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[19]=d[15].get("epoch_root_key"),d[15],c.nativeOperation(b("LSBase64Decode.nop"),d[19]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[21]=d[15].get("epoch_id"),d[15],d[22]=d[15].get("epoch_status"),d[15],d[23]=new c.Map(),d[23].set("epoch_id",d[21]),d[23].set("epoch_anon_id",d[18]==null?c.blob(""):d[18]),d[23].set("epoch_root_key",d[20]==null?c.blob(""):d[20]),d[23].set("epoch_status",d[22]),d[24]=(d[7].push(d[23]),d[7])}])}):c.resolve()},function(e){return d[10]=d[0].get("backup_id"),d[0],d[11]=d[0].get("server_data_id"),d[0],d[12]=new c.Map(),d[12].set("backup_id",d[10]),d[12].set("server_data_id",d[11]),d[12].set("temp_ocmf_client_state",d[2]==null?c.blob(""):d[2]),d[12].set("mailbox_root_key",d[4]==null?c.blob(""):d[4]),d[12].set("oblivious_validation_token",d[6]==null?c.blob(""):d[6]),d[12].set("add_peer_epoch_data",d[7]),d[12]!==void 0?c.sequence([function(e){return c.storedProcedure(b("LSFinishAddPeerDevice"),d[12],a[1])},function(a){return d[13]=!0}]):c.resolve(d[13]=!1)},function(a){return e[0]=d[13]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSDeserializeSecretsAndAddDeviceStoredProcedure",["LSDeserializeSecretsAndAddDevice","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.serializedPayload;d[1]=b.deviceRegistrationId;return c("LSDeserializeSecretsAndAddDevice").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("MWDeserializeSecretsAndAddDevice",["LSDeserializeSecretsAndAddDeviceStoredProcedure","LSFactory"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.initiatorId,d=a.secrets;a=a.storage;return a.runInTransaction(function(a){return c("LSDeserializeSecretsAndAddDeviceStoredProcedure")(c("LSFactory")(a),{deviceRegistrationId:b,serializedPayload:d})},"readwrite")}g["default"]=a}),98);
__d("deserializeSecretsAndAddDevice",["FBLogger","I64","LSEncryptedBackupsRecoveryCodeStatus","LSIntEnum","MWDeserializeSecretsAndAddDevice","MWEncryptedBackupsInitializeRestoreDeferred","MWPakeQPLEvents","PAKEMessageTypeEnum","PakeQplLogging","QPLUserFlow","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var b=a.db,e=a.initiatorId,f=a.onAddDeviceFailure,g=a.onAddDeviceFinish;a=a.secrets;var j=function(){};c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"MEB_DESERIALIZE_SECRETS_AND_ADD_DEVICE_START");return c("MWDeserializeSecretsAndAddDevice")({initiatorId:e,secrets:a,storage:b}).then(function(a){a=a[0];a||(c("FBLogger")("labyrinth_web").mustfix("PAKE: deserializeSecretsAndAddDevice sproc failed"),d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"MEB_DESERIALIZE_SECRETS_AND_ADD_DEVICE_FAILURE",{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").DESERIALIZE_SECRETS_ERROR}}),f());j=d("ReQL").fromTableAscending(b.table("secure_encrypted_backups_recovery_code_status")).subscribe(function(a,e){if(e.operation==="add"||e.operation==="put"){a=e.value.recoveryCodeStatus;if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsRecoveryCodeStatus").VALID))){j();c("QPLUserFlow").addPoint((e=d("MWPakeQPLEvents")).pakeInitiatorQplEvent,"MEB_DESERIALIZE_SECRETS_AND_ADD_DEVICE_END");g();c("QPLUserFlow").addPoint(e.pakeInitiatorQplEvent,"MEB_INITIALIZE_RESTORE_START");d("MWEncryptedBackupsInitializeRestoreDeferred").encryptedBackupsInitializeRestoreDeferred({db:b,onFailure:function(){d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"MEB_INITIALIZE_RESTORE_FAILURE",{bool:{isUserError:!1}})}});c("QPLUserFlow").addPoint(e.pakeInitiatorQplEvent,"MEB_INITIALIZE_RESTORE_END");d("PakeQplLogging").endPakeQPLFlowSuccess(e.pakeInitiatorQplEvent)}else if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR)))c("FBLogger")("labyrinth_web").mustfix("PAKE: LSEncryptedBackupsFinishAddPeerDeviceTask task failed"),d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"MEB_FINISH_ADD_PEER_DEVICE_FAILURE",{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").DESERIALIZE_SECRETS_ERROR}}),f();else{e="PAKE: Unexpected recovery code status: "+(h||(h=d("I64"))).to_int32(a);c("FBLogger")("labyrinth_web").mustfix(e)}}});return j})["catch"](function(a){a="PAKE: error when adding new device using OTC, "+a;c("FBLogger")("labyrinth_web").mustfix(a);d("PakeQplLogging").endPakeQPLFlowFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"MEB_DESERIALIZE_SECRETS_AND_ADD_DEVICE_EXCEPTION",{bool:{isUserError:!1},"int":{errorCode:c("PAKEMessageTypeEnum").DESERIALIZE_SECRETS_ERROR},string:{exceptionMessage:a}});f();j();return function(){}})}g["default"]=a}),98);
__d("MWChatEncryptedBackupsAutoRestoreConsentStep.react",["fbt","CometRelay","FocusRegion.react","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWDialogText.react","MWEBUpsellDismissedEnum.facebook","MWEBUseLocalStorage","MWEncryptedBackupsLocalStorageEntryEnum","MWXButton.react","MWXColumn.react","MWXColumnItem.react","MWXDialogPageLegacy.react","MWXMultiStepDialogHeader.react","MWXRow.react","MWXRowItem.react","QPLUserFlow","focusScopeQueries","gkx","promiseDone","react","requireDeferred","stylex","useEncryptedBackupsQplImpressionRef","xplatToDOMRef"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||d("react"),l=c("requireDeferred")("updateUpsellsStateInRelayStore").__setRef("MWChatEncryptedBackupsAutoRestoreConsentStep.react"),m=c("gkx")("23219"),n={fdsBodyContainer:{paddingBottom:"xwib8y2",paddingEnd:"x1pi30zi",paddingStart:"x1swvt13",$$css:!0},fdsContent:{paddingBottom:"x1l90r2v",paddingTop:"xyamay9",$$css:!0},fdsCtaContainer:{paddingBottom:"xwib8y2",paddingTop:"xyamay9",$$css:!0},mdsBodyContainer:{minHeight:"x2lwn1j",$$css:!0},mdsContent:{paddingBottom:"x1l90r2v",paddingTop:"x1y1aw1k",$$css:!0},mdsCtaContainer:{paddingBottom:"xwib8y2",paddingTop:"xyamay9",$$css:!0},mdsHeadingContainer:{marginTop:"x9otpla",$$css:!0}};function a(a){var b=a.onComplete,e=d("CometRelay").useRelayEnvironment();a=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent,"AUTO_RESTORE_CONSENT_SCREEN_IMPRESSION");return k.jsxs(c("MWXDialogPageLegacy.react"),{includeFDSContentPadding_REMOVE_THIS_AFTER_CONTENT_PADDING_MIGRATION:!1,ref:d("xplatToDOMRef").xplatToDOMRef(a),children:[k.jsx("div",{className:(i||(i=c("stylex")))(m?n.mdsHeadingContainer:null),children:k.jsx(c("MWXMultiStepDialogHeader.react"),{title:h._("__JHASH__oOLwSyBIK6Q__JHASH__"),withCloseButton:!1,withoutBackButton:!0})}),k.jsx("div",{className:i(m?n.mdsBodyContainer:n.fdsBodyContainer),children:k.jsxs(c("MWXColumn.react"),{align:"center",testid:void 0,children:[k.jsx(c("MWXColumnItem.react"),{align:m?"center":"start",children:k.jsx("div",{className:i(m?n.mdsContent:n.fdsContent),children:k.jsx(c("MWDialogText.react"),{align:"start",testid:void 0,type:"body",children:h._("__JHASH__8Pc1AS8cP5M__JHASH__")})})}),k.jsx(c("MWXColumnItem.react"),{align:"stretch",children:k.jsx("div",{className:i(m?n.mdsCtaContainer:n.fdsCtaContainer),children:k.jsxs(c("MWXRow.react"),{align:"end",paddingHorizontal:0,paddingVertical:0,spacing:8,children:[k.jsx(c("MWXRowItem.react"),{expanding:m,children:k.jsx(c("MWXButton.react"),{label:h._("__JHASH__qYs0K2Ysi-h__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent,"AUTO_RESTORE_CONSENT_DECLINE_CTA_CLICK"),d("MWEBUseLocalStorage").mwEBDeleteLocalStorageEntry(c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_REMEMBER_BROWSER_CONSENT),d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent}),c("promiseDone")(l.load(),function(a){a({environment:e,updateValue:d("MWEBUpsellDismissedEnum.facebook").MWEBUpsellDismissedStateEnum.ALL_DISMISSED})}),b()},reduceEmphasis:!m,testid:void 0,type:"secondary"})}),k.jsx(c("MWXRowItem.react"),{expanding:m,children:k.jsx(d("FocusRegion.react").FocusRegion,{autoFocusQuery:d("focusScopeQueries").tabbableScopeQuery,children:k.jsx(c("MWXButton.react"),{label:h._("__JHASH__9UXa8IqlGXK__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent,"AUTO_RESTORE_CONSENT_CONFIRM_CTA_CLICK"),d("MWEBUseLocalStorage").mwEBCreateLocalStorageEntry(c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_REMEMBER_BROWSER_CONSENT),d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent}),c("promiseDone")(l.load(),function(a){a({environment:e,updateValue:d("MWEBUpsellDismissedEnum.facebook").MWEBUpsellDismissedStateEnum.ALL_DISMISSED})}),b()},padding:"wide",testid:void 0,type:"primary"})})})]})})})]})})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("useMWChatEncryptedBackupsAutoRestore",["MWChatEncryptedBackupsAddDeviceWithEBKeys","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsQPLSource.enum","MWEBODSEntityName.enum","MWEBUseLocalStorage","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsLocalStorageEntryEnum","MWEncryptedBackupsSharedState","ReQL","ReQLSuspense","cr:4062","react","useLabyrinthLogging","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;e=i||d("react");var j=e.useEffect,k=e.useRef,l=e.useState;function a(){var a=c("MWChatEncryptedBackupsQPLSource.enum").AUTO_RESTORE,e=l(!0),g=e[0],i=e[1],m=(h||(h=c("useReStore")))();e=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var n=e.startFlow,o=d("ReQLSuspense").useFirst(function(){return g?d("ReQL").fromTableAscending(m.table("secure_encrypted_backups_epochs")):d("ReQL").empty()},[g,m],f.id+":40"),p=d("ReQLSuspense").useFirst(function(){return g?d("ReQL").fromTableAscending(m.table("secure_encrypted_backups_client_state")):d("ReQL").empty()},[g,m],f.id+":47"),q=b("cr:4062")({}),r=d("ReQLSuspense").useArray(function(){return g?d("ReQL").fromTableAscending(m.table("experiences_shared_state")):d("ReQL").empty()},[g,m],f.id+":57"),s=k(!1);j(function(){if(s.current||q===1||q===0)return;if(q===3){var b=p==null?void 0:p.deviceId,e=d("MWEncryptedBackupsSharedState").getIsEntryPresentInSharedState({db:m,sharedStateTable:r,stateKey:"auto_restored"}),f=d("MWEncryptedBackupsSharedState").getIsEntryPresentInSharedState({db:m,sharedStateTable:r,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY}),g=d("MWEncryptedBackupsSharedState").getIsEntryPresentInSharedState({db:m,sharedStateTable:r,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_ONBOARDED_SUCCESSFULLY});e=e||f||g;f=d("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();if(!e&&f!==""&&p!=null&&o!=null&&b!=null){d("MWEBUseLocalStorage").mwEBCreateLocalStorageEntry(c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_REMEMBER_BROWSER_CONSENT);n({additionalAnnotations:{device_type:"auto_restore"},event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH,source:a});g=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();n({additionalAnnotations:{eb_session_identifier:g,restore_upsell_first_impression_time:g},event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,source:a});d("MWChatEncryptedBackupsAddDeviceWithEBKeys").addDeviceWithEBKeys({backupId:p.backupId,db:m,newDeviceRegistrationId:f,previousDeviceId:b})}}s.current=!0;i(!1)},[q,p,o,r,a,n,m])}g["default"]=a}),98);
__d("MWChatEncryptedBackupsForgotPinStep.react",["fbt","MWChatEncryptedBackupsAddonIcon.react","MWChatEncryptedBackupsChevronRightIconMedium.react","MWChatEncryptedBackupsForgotPinInformationalResetPin.react","MWChatEncryptedBackupsLayout.react","MWChatEncryptedBackupsMobileRotateIconSmall.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsTextIconSmall.react","MWXListCellPressable.react","MWXText.react","MWXTextPairing.react","QPLUserFlow","cr:6808","pushRCRestoreStep","react","useEncryptedBackupsQplImpressionRef","useMWChatEncryptedBackupsAutoRestoreConsentStep"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(a){var e=a.isGDriveDeviceEnabled,f=a.isRCDeviceEnabled,g=a.onClose,i=a.onComplete,k=a.pushPage,l=function(){k(function(){return j.jsx(c("MWChatEncryptedBackupsForgotPinInformationalResetPin.react"),{onClose:g,onComplete:i,pushPage:k})})},m=b("cr:6808")==null?void 0:b("cr:6808")();a=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_OPTIONS_SCREEN_IMPRESSION");var n=c("useMWChatEncryptedBackupsAutoRestoreConsentStep")({onComplete:i});return j.jsxs(c("MWChatEncryptedBackupsLayout.react"),{actionsDirection:"column",ref:a,showTopMargin:!1,title:h._("__JHASH__aG4R6bxLQ0N__JHASH__"),children:[j.jsx(c("MWXText.react"),{type:"meta3",children:h._("__JHASH__MeLYonSVEOM__JHASH__")}),j.jsxs("div",{className:"x9a3u73 x1p5oq8j xfdjxqc",children:[j.jsx(c("MWXListCellPressable.react"),{addOnEnd:j.jsx(c("MWChatEncryptedBackupsChevronRightIconMedium.react"),{}),addOnEndVerticalAlign:"center",addOnStart:j.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:j.jsx(c("MWChatEncryptedBackupsMobileRotateIconSmall.react"),{})}),addOnStartVerticalAlign:"center","aria-label":h._("__JHASH__S1KydYJcRDi__JHASH__"),content:j.jsx(c("MWXTextPairing.react"),{body:h._("__JHASH__S1KydYJcRDi__JHASH__"),bodyColor:"secondary",headline:h._("__JHASH__QIw_F3RIyEo__JHASH__"),level:4}),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_OPTIONS_SCREEN_ACTION_RESET_PIN"),l()},testid:void 0}),e&&m?j.jsx(c("MWXListCellPressable.react"),{addOnEnd:j.jsx(c("MWChatEncryptedBackupsChevronRightIconMedium.react"),{}),addOnEndVerticalAlign:"center",addOnStart:j.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:j.jsx(c("MWChatEncryptedBackupsTextIconSmall.react"),{})}),addOnStartVerticalAlign:"center",content:j.jsx(c("MWXText.react"),{align:"start",type:"headlineEmphasized4",children:h._("__JHASH__8xIuMgdlV3G__JHASH__")}),onPress:function(){m(k)},testid:void 0}):null,f?j.jsx(c("MWXListCellPressable.react"),{addOnEnd:j.jsx(c("MWChatEncryptedBackupsChevronRightIconMedium.react"),{}),addOnEndVerticalAlign:"center",addOnStart:j.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:j.jsx(c("MWChatEncryptedBackupsTextIconSmall.react"),{})}),addOnStartVerticalAlign:"center",content:j.jsx(c("MWXText.react"),{align:"start",type:"headlineEmphasized4",children:h._("__JHASH__yY8fizSLvt5__JHASH__")}),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_OPTIONS_SCREEN_ACTION_ENTER_RECOVERY_CODE");var a=n.onPushAutoRestoreConsentPage(k);c("pushRCRestoreStep")({onClose:g,onComplete:a,pushPage:k,shouldShowForgotButton:!0})},testid:void 0}):null]})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWChatEncryptedBackupsGenerateNewRecoveryCodeInstruction.react",["fbt","MWChatEncryptedBackupsLayout.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsRecoveryCodeIcon.react","MWChatEncryptedBackupsRestoreEndOfRoadDialog.react","MWXButton.react","MWXLink.react","MWXListCell.react","MWXMultiStepDialogHeader.react","MWXTextPairing.react","QPLUserFlow","pushRCRestoreStep","react","useEncryptedBackupsQplImpressionRef","useMWChatEncryptedBackupsAutoRestoreConsentStep"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k="https://www.facebook.com/help/messenger-app/3357856081116516?ref=learn_more";function a(a){var b=a.onClose,e=a.onCloseDialogWithConfirmation,f=a.onComplete,g=a.onDontRestore,i=a.pushPage,l=e!=null,m=c("useMWChatEncryptedBackupsAutoRestoreConsentStep")({onComplete:f}),n=function(){i(function(){return j.jsxs(j.Fragment,{children:[l?j.jsx(c("MWXMultiStepDialogHeader.react"),{onClose:e,title:null,withCloseButton:!0,withoutBackButton:!0}):null,j.jsx(c("MWChatEncryptedBackupsRestoreEndOfRoadDialog.react"),{onClose:f,onDontRestore:g})]})})};a=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_TROUBLESHOOT_RC_SCREEN_IMPRESSION");return j.jsx(c("MWChatEncryptedBackupsLayout.react"),{actionsDirection:"column",icon:j.jsx(c("MWChatEncryptedBackupsRecoveryCodeIcon.react"),{}),primaryAction:j.jsx(c("MWXButton.react"),{label:h._("__JHASH__DnKZRulcqGe__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_TROUBLESHOOT_RC_SCREEN_ACTION_ENTER_CODE");var a=m.onPushAutoRestoreConsentPage(i);c("pushRCRestoreStep")({onClose:b,onComplete:a,pushPage:i,shouldShowForgotButton:!1})},testid:void 0}),ref:a,secondaryAction:j.jsx(c("MWXButton.react"),{label:h._("__JHASH__wkez3K_SoHV__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_TROUBLESHOOT_RC_SCREEN_ACTION_CANT_GENERATE_CODE"),n()},type:"secondary"}),title:h._("__JHASH__qROoBeCmzeY__JHASH__"),children:j.jsxs("div",{className:"xvue9z",children:[j.jsx(c("MWXListCell.react"),{content:j.jsx(c("MWXTextPairing.react"),{body:j.jsxs(j.Fragment,{children:[h._("__JHASH__D6e8Mh9DE8a__JHASH__")," ",j.jsx(c("MWXLink.react"),{display:"inline",href:k,onClick:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_TROUBLESHOOT_SCREEN_ACTION_OPEN_LEARN_MORE_LINK")},rel:"noreferrer",target:"_blank",children:j.jsx("b",{children:h._("__JHASH__yk1kU3qH_5u__JHASH__")})})]}),bodyColor:"secondary",headline:h._("__JHASH__aZTN0eX3kw4__JHASH__"),level:4})}),j.jsx(c("MWXListCell.react"),{content:j.jsx(c("MWXTextPairing.react"),{body:j.jsxs(j.Fragment,{children:[h._("__JHASH__HG5XJ8DHe4v__JHASH__"),j.jsx("br",{}),h._("__JHASH__ZfRAIOlNhhF__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__mnPynM3vIb8__JHASH__")}))]),j.jsx("br",{}),h._("__JHASH__8h6q580afos__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__8Oq20T6QwSt__JHASH__")}))]),j.jsx("br",{}),h._("__JHASH__XEDcoIgGX9g__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__0zO-AR2mh_u__JHASH__")}))]),j.jsx("br",{}),h._("__JHASH__TJHGYNx1Byx__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__ORhXAbatdS9__JHASH__")}))])]}),bodyColor:"secondary",headline:h._("__JHASH__csYZJmhxxDs__JHASH__"),level:4})})]})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("useMAWEncryptedBackupsRestoreToast",["fbt","ix","BaseToasterStateManager","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","QPLUserFlow","SVGIcon","cr:1376","cr:4027","cr:6570","fbicon","mwPushToast","react","useLabyrinthLogging"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=j||(j=d("react"));e=j;var l=e.useCallback,m=e.useRef;function a(){var a=m(null),e=d("useLabyrinthLogging").useLabyrinthLoggingFlow(),f=e.startFlow,g=b("cr:6570")?k.jsx(b("cr:6570"),{color:"primary",icon:d("fbicon")._(i("538038"),24)}):void 0,j=b("cr:1376")?new(b("cr:1376"))(i("685423"),32,32):void 0,n=c("BaseToasterStateManager").getInstance(),o=l(function(){if(a.current==null)return;n.expire(a.current);a.current=null},[n]);e=function(){o(),a.current=d("mwPushToast").mwPushToast({body:h._("__JHASH__olvnGjG-r7f__JHASH__"),icon:{comet:g,mds:j},testid:"mw-chat-encrypted-backups-restore-in-progress-toast"}),f({event:d("MWChatEncryptedBackupsQPLEvents").messageRestoreQplEvent}),c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").messageRestoreQplEvent,"restore_begin_toast")};var p=l(function(){o(),d("mwPushToast").mwPushErrorToast({body:h._("__JHASH__w8j4IGt-9Wa__JHASH__")})},[o]),q=function(){var e=b("cr:6570")?k.jsx(b("cr:6570"),{icon:d("fbicon")._(i("477815"),24)}):void 0,f=b("cr:4027")?d("SVGIcon").svgIcon(b("cr:4027")):void 0;o();a.current=d("mwPushToast").mwPushToast({body:h._("__JHASH__75ZoIDN05wr__JHASH__"),icon:{comet:e,mds:f},testid:"mw-chat-encrypted-backups-restore-successful-toast"});c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").messageRestoreQplEvent,"restore_successful_toast");d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").messageRestoreQplEvent})};return{hideToast:o,showErrorToast:p,showInProgressToast:e,showSuccessToast:q}}g["default"]=a}),226);
__d("useMWChatDisplayEncryptedBackupsRestoreToast",["I64","LSEncryptedBackupsClientRestoreState","LSIntEnum","ReQL","ReQLSuspense","react","useMAWEncryptedBackupsRestoreToast","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;b=k||d("react");var l=b.useEffect,m=b.useState;function a(){var a=(h||(h=c("useReStore")))(),b=d("ReQLSuspense").useArray(function(){return d("ReQL").fromTableAscending(a.tables.encrypted_backups_client_restore_status)},[a],f.id+":27"),e=c("useMAWEncryptedBackupsRestoreToast")(),g=e.showInProgressToast,k=e.showSuccessToast;e=m(!1);var n=e[0],o=e[1];l(function(){var a=b.some(function(a){a=a.restoreStatus;return a!=null&&(i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsClientRestoreState").RESTORE_IN_PROGRESS))});n&&!a?(o(!1),k()):!n&&a&&(o(!0),g())},[n,b,g,k])}g["default"]=a}),98);
__d("MWChatEncryptedBackupsCreatePinInstruction.react",["fbt","MWChatEncryptedBackupsForgotPinInformationalResetPin.react","MWChatEncryptedBackupsLayout.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsRecoveryCodeIcon.react","MWChatEncryptedBackupsRestoreEndOfRoadDialog.react","MWXButton.react","MWXLink.react","MWXListCell.react","MWXText.react","MWXTextPairing.react","QPLUserFlow","deferredLoadComponent","react","requireDeferred","useEncryptedBackupsQplImpressionRef","useMWEncryptedBackupsListenForChangesToVirtualDevicesV2"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));b=i;var k=b.useCallback,l=b.useState,m=c("deferredLoadComponent")(c("requireDeferred")("MWChatEncryptedBackupsPinCodeRestoreStep.react").__setRef("MWChatEncryptedBackupsCreatePinInstruction.react")),n="https://www.facebook.com/help/messenger-app/3357856081116516?ref=learn_more";function a(a){var b=a.onClose,e=a.onComplete,f=a.pushPage;a=l(!0);var g=a[0];a=a[1];var i=c("useMWEncryptedBackupsListenForChangesToVirtualDevicesV2")(),o=i.vestaClientID;g&&o!=null&&a(!1);var p=k(function(){return f(function(){return j.jsx(c("MWChatEncryptedBackupsRestoreEndOfRoadDialog.react"),{onClose:b})})},[b,f]),q=k(function(){return f(function(){return j.jsx(c("MWChatEncryptedBackupsForgotPinInformationalResetPin.react"),{onClose:b,onComplete:e,pushPage:f})})},[b,f,e]),r=k(function(){return f(function(){return o==null?null:j.jsx(m,{clientID:o,onChooseOtc:null,onClose:b,onComplete:e,onForgotPin:q})})},[b,e,f,o,q]);i=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_PIN_SCREEN_IMPRESSION");return j.jsxs(c("MWChatEncryptedBackupsLayout.react"),{actionsDirection:"column",icon:j.jsx(c("MWChatEncryptedBackupsRecoveryCodeIcon.react"),{}),primaryAction:j.jsx(c("MWXButton.react"),{disabled:g,label:h._("__JHASH__azfzhOvLeld__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_PIN_SCREEN_ENTER_PIN_CLICK"),r()}}),ref:i,secondaryAction:j.jsx(c("MWXButton.react"),{label:h._("__JHASH__JYt7hk4FEPk__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_PIN_SCREEN_CANT_CREATE_PIN_CLICK"),p()},type:"secondary"}),children:[j.jsx("div",{className:"xewm4ob",children:j.jsx(c("MWXText.react"),{align:"center",type:"headlineEmphasized2",children:h._("__JHASH__r-UBPe_4xvO__JHASH__")})}),j.jsxs("div",{className:"x169t7cy x19f6ikt xm77wn2 xvue9z",children:[j.jsx(c("MWXListCell.react"),{content:j.jsx(c("MWXTextPairing.react"),{headline:h._("__JHASH__I5BWRfz9kj6__JHASH__"),level:4,meta:j.jsxs(j.Fragment,{children:[h._("__JHASH__66f6j4edNUW__JHASH__")," ",j.jsx(c("MWXLink.react"),{display:"inline",href:n,onClick:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_PIN_SCREEN_LEARN_MORE_LINK_CLICK")},rel:"noreferrer",target:"_blank",children:j.jsx("b",{children:h._("__JHASH__yk1kU3qH_5u__JHASH__")})})]})})}),j.jsx("br",{}),j.jsx(c("MWXListCell.react"),{content:j.jsx(c("MWXTextPairing.react"),{headline:h._("__JHASH__6OnapwRiU-I__JHASH__"),level:4,meta:j.jsxs(c("MWXText.react"),{type:"meta4",children:[h._("__JHASH__Hyp2Dk13FKd__JHASH__"),j.jsx("br",{}),h._("__JHASH__KtIvQ3G8r-K__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__mnPynM3vIb8__JHASH__")}))]),j.jsx("br",{}),h._("__JHASH__YLnPm0Rvu_i__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__8Oq20T6QwSt__JHASH__")}))]),j.jsx("br",{}),h._("__JHASH__Bvgp1w5pZ4___JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__0zO-AR2mh_u__JHASH__")}))]),j.jsx("br",{}),h._("__JHASH__M34cp2-7gGO__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__0dYzuV-3JUF__JHASH__")}))])]})})})]})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWChatEncryptedBackupsCreateRecoveryCodeInstruction.react",["fbt","MWChatEncryptedBackupsGenerateNewRecoveryCodeInstruction.react","MWChatEncryptedBackupsLayout.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsRecoveryCodeIcon.react","MWChatEncryptedBackupsRestoreEndOfRoadDialog.react","MWXButton.react","MWXLink.react","MWXListCell.react","MWXText.react","MWXTextPairing.react","QPLUserFlow","pushRCRestoreStep","react","useEncryptedBackupsQplImpressionRef","useMWChatEncryptedBackupsAutoRestoreConsentStep","useMWEncryptedBackupsListenForChangesToVirtualDevicesV2"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));b=i;var k=b.useCallback,l=b.useState,m="https://www.facebook.com/help/messenger-app/3357856081116516?ref=learn_more";function a(a){var b=a.onClose,e=a.onComplete,f=a.pushPage;a=l(!0);var g=a[0];a=a[1];var i=c("useMWEncryptedBackupsListenForChangesToVirtualDevicesV2")();i=i.offlineDevicesCount;var n=c("useMWChatEncryptedBackupsAutoRestoreConsentStep")({onComplete:e});g&&i>0&&a(!1);var o=k(function(){return f(function(){return j.jsx(c("MWChatEncryptedBackupsRestoreEndOfRoadDialog.react"),{onClose:b})})},[b,f]),p=k(function(){return f(function(){return j.jsx(c("MWChatEncryptedBackupsGenerateNewRecoveryCodeInstruction.react"),{onClose:b,onComplete:e,pushPage:f})})},[b,e,f]);i=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_RC_SCREEN_IMPRESSION");return j.jsxs(c("MWChatEncryptedBackupsLayout.react"),{actionsDirection:"column",icon:j.jsx(c("MWChatEncryptedBackupsRecoveryCodeIcon.react"),{}),primaryAction:j.jsx(c("MWXButton.react"),{disabled:g,label:h._("__JHASH__5c2KiSYPIxj__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_RC_SCREEN_ENTER_CODE_CLICK");var a=n.onPushAutoRestoreConsentPage(f);c("pushRCRestoreStep")({onClose:b,onComplete:a,onForgotRC:p,pushPage:f,shouldShowForgotButton:!1})}}),ref:i,secondaryAction:j.jsx(c("MWXButton.react"),{label:h._("__JHASH__wkez3K_SoHV__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_RC_SCREEN_CANT_GENERATE_CODE_CLICK"),o()},type:"secondary"}),children:[j.jsx("div",{className:"xewm4ob",children:j.jsx(c("MWXText.react"),{align:"center",type:"headlineEmphasized2",children:h._("__JHASH__ePYUiQEv2Jf__JHASH__")})}),j.jsxs("div",{className:"x169t7cy x19f6ikt xm77wn2 xvue9z",children:[j.jsx(c("MWXListCell.react"),{content:j.jsx(c("MWXTextPairing.react"),{headline:h._("__JHASH__j4tUcRVJrVr__JHASH__"),level:4,meta:j.jsxs(j.Fragment,{children:[h._("__JHASH__LvOpAmvQ9Zs__JHASH__")," ",j.jsx(c("MWXLink.react"),{display:"inline",href:m,onClick:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_TROUBLESHOOT_RC_SCREEN_LEARN_MORE_LINK_CLICK")},rel:"noreferrer",target:"_blank",children:j.jsx("b",{children:h._("__JHASH__JFv5llOM1oL__JHASH__")})})]})})}),j.jsx("br",{}),j.jsx(c("MWXListCell.react"),{content:j.jsx(c("MWXTextPairing.react"),{headline:h._("__JHASH__PbR9w7iOzwd__JHASH__"),level:4,meta:j.jsxs(c("MWXText.react"),{type:"meta4",children:[h._("__JHASH__HG5XJ8DHe4v__JHASH__"),j.jsx("br",{}),h._("__JHASH__ZfRAIOlNhhF__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__mnPynM3vIb8__JHASH__")}))]),j.jsx("br",{}),h._("__JHASH__8h6q580afos__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__8Oq20T6QwSt__JHASH__")}))]),j.jsx("br",{}),h._("__JHASH__XEDcoIgGX9g__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__0zO-AR2mh_u__JHASH__")}))]),j.jsx("br",{}),h._("__JHASH__TJHGYNx1Byx__JHASH__",[h._implicitParam("=m1",j.jsx("b",{children:h._("__JHASH__ORhXAbatdS9__JHASH__")}))])]})})})]})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWChatEncryptedBackupsKVSOnlyRestoreStep.react",["fbt","MWChatEncryptedBackupsAddonIcon.react","MWChatEncryptedBackupsChevronRightIconMedium.react","MWChatEncryptedBackupsCreatePinInstruction.react","MWChatEncryptedBackupsCreateRecoveryCodeInstruction.react","MWChatEncryptedBackupsDots3HorizontalIconSmall.react","MWChatEncryptedBackupsInterstitialIcon.react","MWChatEncryptedBackupsLayout.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsTextIconSmall.react","MWXListCellPressable.react","MWXText.react","MWXTextPairing.react","QPLUserFlow","react","useEncryptedBackupsQplImpressionRef"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react")),k=i.useCallback;function a(a){var b=a.onClose,e=a.onComplete,f=a.pushPage,g=k(function(){return f(function(){return j.jsx(c("MWChatEncryptedBackupsCreatePinInstruction.react"),{onClose:b,onComplete:e,pushPage:f})})},[b,e,f]),i=k(function(){return f(function(){return j.jsx(c("MWChatEncryptedBackupsCreateRecoveryCodeInstruction.react"),{onClose:b,onComplete:e,pushPage:f})})},[b,e,f]);a=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_OPTIONS_IMPRESSION");return j.jsxs(c("MWChatEncryptedBackupsLayout.react"),{actionsDirection:"column",icon:j.jsx(c("MWChatEncryptedBackupsInterstitialIcon.react"),{}),innerContentPaddingVertical:0,ref:a,title:h._("__JHASH__JiPJcQZ2ODs__JHASH__"),children:[j.jsx(c("MWXText.react"),{color:"secondary",type:"body4",children:h._("__JHASH__KBLSFG_4ok9__JHASH__")}),j.jsxs("div",{className:"x1miatn0 x2b8uid xk68kj7",children:[j.jsx(c("MWXListCellPressable.react"),{addOnEnd:j.jsx(c("MWChatEncryptedBackupsChevronRightIconMedium.react"),{}),addOnEndVerticalAlign:"center",addOnStart:j.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:j.jsx(c("MWChatEncryptedBackupsDots3HorizontalIconSmall.react"),{})}),addOnStartVerticalAlign:"center",content:j.jsx(c("MWXTextPairing.react"),{headline:h._("__JHASH__U-M3lpEzQQ___JHASH__"),level:4}),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_PIN_CODE_CLICK"),g()}}),j.jsx(c("MWXListCellPressable.react"),{addOnEnd:j.jsx(c("MWChatEncryptedBackupsChevronRightIconMedium.react"),{}),addOnEndVerticalAlign:"center",addOnStart:j.jsx(c("MWChatEncryptedBackupsAddonIcon.react"),{icon:j.jsx(c("MWChatEncryptedBackupsTextIconSmall.react"),{})}),addOnStartVerticalAlign:"center",content:j.jsx(c("MWXTextPairing.react"),{headline:h._("__JHASH__X81OWLrHpAK__JHASH__"),level:4}),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_KVS_RECOVERY_CODE_CLICK"),i()}})]})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWChatEncryptedBackupsAccessCodeInput.react",["fbt","BaseTextArea.react","MWXText.react","react","stylex"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react")),l=j.useRef,m={bigContainer:{marginTop:"x1xmf6yo",paddingStart:"x1m6arcz",paddingEnd:"x13omvei",$$css:!0},containerDefaults:{backgroundColor:"x443n21",borderTopStartRadius:"x1a2cdl4",borderTopEndRadius:"xnhgr82",borderBottomEndRadius:"x1qt0ttw",borderBottomStartRadius:"xgk8upj",paddingBottom:"x1g2khh7",paddingTop:"xyamay9",textAlign:"x2b8uid",":hover_backgroundImage":"x10bruuh",$$css:!0},input:{backgroundColor:"xjbqb8w",borderTopStyle:"x1ejq31n",borderEndStyle:"xd10rxx",borderBottomStyle:"x1sy0etr",borderStartStyle:"x17r0tee",color:"xzsf02u",end:"xds687c",left:null,right:null,fontSize:"x1lkfr7t",fontWeight:"x1s688f",height:"x5yr21d",letterSpacing:"xoiqa5b",lineHeight:"x11m8ghp",overflowX:"x6ikm8r",overflowY:"x10wlt62",paddingBottom:"x18d9i69",paddingTop:"x1y1aw1k",position:"x10l6tqk",start:"x17qophe",top:"x1jzctok",width:"xh8yej3","::placeholder_color":"xha3pab",$$css:!0},smallContainer:{marginBottom:"x12nagc",paddingBottom:"x18d9i69",width:"x1s1gtqi",$$css:!0}},n="---- ---- ---- ---- ----\n---- ---- ---- ---- ----",o=40;function a(a){var b=a.autoSubmit,d=b===void 0?!1:b;b=a.disabled;b=b===void 0?!1:b;var e=a.onComplete,f=a.onFocus,g=a.onValueChange,j=a.smallInput,r=a.value;a=l();var s=function(a){return a.toUpperCase().replace(/[^A-Z0-9]/g,"")},t=function(a){a=s(a).substring(0,o);var b=s(r);if(a===b)return;g(a);a.length===o&&d&&(e==null?void 0:e(a))};return k.jsxs("div",{className:(i||(i=c("stylex")))(m.containerDefaults,j?m.smallContainer:m.bigContainer),children:[k.jsx(c("MWXText.react"),{type:"meta3",children:h._("__JHASH__xBAImOW2o36__JHASH__")}),k.jsxs("div",{className:"xwzfr38 xr1yuqi xkrivgy x4ii5y1 x1gryazu x1n2onr6 x1hfn5x7",children:[k.jsx("span",{style:{fontFamily:"var(--font-family-code)"},children:k.jsx(c("BaseTextArea.react"),{disabled:b,maxRows:2,onFocus:f,placeholder:n,readOnly:!0,suppressFocusRing:!0,unresizable:!0,value:r===""?n:q(r),xstyle:m.input})}),k.jsx("span",{style:{fontFamily:"var(--font-family-code)"},children:k.jsx(c("BaseTextArea.react"),{disabled:b,maxRows:2,onFocus:f,onValueChange:t,ref:a,suppressFocusRing:!0,testid:void 0,unresizable:!0,value:r===""?r:p(r),xstyle:m.input})})]})]})}a.displayName=a.name+" [from "+f.id+"]";function p(a){a=a.split("");var b=0,c=[];for(var a=a,d=Array.isArray(a),e=0,a=d?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=a.length)break;f=a[e++]}else{e=a.next();if(e.done)break;f=e.value}f=f;c.length===24?c.push("\n"):b>0&&b%4===0&&c.push(" ");c.push(f);b+=1}return c.join("")}function q(a){var b=a.split("");return n.split("").map(function(a){if(a===" "||a==="\n"||b.length===0)return a;else{b.pop();return" "}}).join("")}g["default"]=a}),226);
__d("MWChatEncryptedBackupsAccessCodeInputStep.react",["fbt","CometProgressButtonIndeterminate.react","EBSMGating","MWChatEncryptedBackupsAccessCodeInput.react","MWChatEncryptedBackupsLayout.react","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","MWEncryptedBackupsLocalStorageEntryEnum","MWXButton.react","MWXText.react","QPLUserFlow","promiseDone","react","requireDeferred","useEncryptedBackupsQplImpressionRef","useLabyrinthLogging","useMAWEncryptedBackupsRestoreToast","useMWChatEncryptedBackupsAddDevice","useMWEBFlowSourceContext","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react"));b=j;var l=b.useCallback,m=b.useState,n=c("requireDeferred")("MWEBUseLocalStorage").__setRef("MWChatEncryptedBackupsAccessCodeInputStep.react"),o=c("requireDeferred")("MWEncryptedBackupsSharedState").__setRef("MWChatEncryptedBackupsAccessCodeInputStep.react"),p=h._("__JHASH__T0C_5M__5DH__JHASH__");function a(a){var b=a.onChooseOtc,e=a.onComplete,f=a.onForgotRC;a=a.shouldShowForgotButton;a=a===void 0?!0:a;var g=(i||(i=c("useReStore")))(),j=h._("__JHASH__7iiwqV3Z6Ok__JHASH__"),q=m(""),r=q[0],s=q[1];q=m(!1);var t=q[0],u=q[1];q=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var v=q.startFlow;q=l(function(){d("MWChatEncryptedBackupsLogging").endFailure({errorName:"wrong_recovery_code",event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityKey:c("MWEBODSEntityKey.enum").INCORRECT_RECOVERY_CODE,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_RC_RESTORE_AUTH}),c("QPLUserFlow").markError(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"invalid_recovery_code_input"),u(!0)},[]);var w=c("useMAWEncryptedBackupsRestoreToast")(),x=w.showErrorToast,y=c("useMWEBFlowSourceContext")();w=function(a){t&&u(!1),s(a)};q=c("useMWChatEncryptedBackupsAddDevice")({onComplete:l(function(){var a;c("QPLUserFlow").addPoint((a=d("MWChatEncryptedBackupsQPLEvents")).restoreDeviceAuthQplEvent,"add_device_success");c("QPLUserFlow").addPoint(a.restoreQplEvent,"restore_auth_finished_and_dismissed");o.onReady(function(a){a=a.upsertEBSharedStateEntry;c("promiseDone")(a({db:g,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY}))});n.onReady(function(a){var b=a.mwEBCreateLocalStorageEntry;a=a.mwEBDeleteLocalStorageEntry;b(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION);b(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION_2);a(c("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE)});d("MWChatEncryptedBackupsLogging").endSuccess({annotations:{bool:{is_backend_setup:d("EBSMGating").isBackendSetupSuccessfulForEBSM()}},event:a.restoreQplEvent});d("MWChatEncryptedBackupsLogging").endSuccess({event:a.restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_RC_RESTORE_AUTH});e()},[g,e]),onFailure:l(function(){d("MWChatEncryptedBackupsLogging").endFailure({errorName:"add_device_error",event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),d("MWChatEncryptedBackupsLogging").endFailure({errorName:"add_device_error",event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_RC_RESTORE_AUTH}),x()},[x]),onInvalidRecoveryCode:q});var z=q[0];q=q[1];var A=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_ENTER_RECOVERY_CODE_SCREEN_IMPRESSION",function(){B!=null&&c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_OPTION_DISPLAYED_RESTORE_SCREEN")});a=a?k.jsx(c("MWXButton.react"),{label:h._("__JHASH__TJHhepIDy5c__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_ENTER_RECOVERY_CODE_SCREEN_ACTION_DONT_HAVE_RC"),f()},testid:void 0,type:"secondary"}):null;var B=b!==null?k.jsx(c("MWXButton.react"),{label:h._("__JHASH__rIytKXj5Yr0__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_USE_ONE_TIME_CODE_CLICK"),b()},reduceEmphasis:!1,testid:void 0,type:"secondary"}):null;a=B!=null?B:a;return k.jsxs(c("MWChatEncryptedBackupsLayout.react"),{actionsDirection:"column",primaryAction:q?k.jsx(c("CometProgressButtonIndeterminate.react"),{label:p}):k.jsx(c("MWXButton.react"),{disabled:r.length<40,label:p,onPress:function(){var a;c("QPLUserFlow").addPoint((a=d("MWChatEncryptedBackupsQPLEvents")).restoreQplEvent,"RESTORE_ENTER_RECOVERY_CODE_SCREEN_ACTION_SUBMIT");var b=y();c("QPLUserFlow").addAnnotations(a.restoreQplEvent,{string:{restore_type:"recovery_code",source:b}});v({additionalAnnotations:{device_type:"OFFLINE"},event:a.restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_RC_RESTORE_AUTH});c("QPLUserFlow").addPoint(a.restoreDeviceAuthQplEvent,"add_device_begin");z(r)},testid:void 0}),ref:A,secondaryAction:q?null:a,showTopMargin:!1,title:h._("__JHASH__8BMtxO3Z_MC__JHASH__"),children:[k.jsx("div",{className:"xwib8y2",children:k.jsx(c("MWXText.react"),{type:"meta3",children:j})}),k.jsx(c("MWChatEncryptedBackupsAccessCodeInput.react"),{onValueChange:w,smallInput:!1,value:r}),t?k.jsx("div",{className:"x5ib6vp xc73u3c xz9dl7a",children:k.jsx(c("MWXText.react"),{align:"center",color:"negative",testid:void 0,type:"meta3",children:h._("__JHASH__a6pa6P3ejkP__JHASH__")})}):null]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MAWEncryptedBackupsClearRecoveryCode",["Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return(h||(h=b("Promise"))).all([d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_recovery_code_data)),d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_recovery_code_status))]).then(function(c){var d=c[0],e=c[1];if(d!=null||e!=null)return a.runInTransaction(function(a){return(h||(h=b("Promise"))).all([(d==null?void 0:d.taskId)!=null?a.secure_recovery_code_data["delete"](d.taskId):(h||(h=b("Promise"))).resolve(),(e==null?void 0:e.pk)!=null?a.secure_encrypted_backups_recovery_code_status["delete"](e.pk):(h||(h=b("Promise"))).resolve()])},"readwrite")})}g.encryptedBackupsClearRecoveryCode=a}),98);
__d("updateUpsellsStateInRelayStore",["CometRelay","FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.environment,e=a.updateValue;d("CometRelay").commitLocalUpdate(b,function(a){a=a.getRoot().getLinkedRecord("viewer");if(a==null){c("FBLogger")("labyrinth_web").mustfix("[labyrinth][upsells] A viewer record does not exist when updating upsell state.");return}a.setValue(e,"is_eb_restore_upsells_dismissed")})}g["default"]=a}),98);
__d("MWChatEncryptedBackupsSettingsDialog.entrypoint",["JSResourceForInteraction","MWChatEncryptedBackupsSettingsDialogQuery$Parameters","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=c("gkx")("23656"),i=c("gkx")("1850");a={getPreloadProps:function(){return{queries:{queryReference:{parameters:c("MWChatEncryptedBackupsSettingsDialogQuery$Parameters"),variables:{isEBWebPreImprovementsEnabled:h,soapEncryptedBackupEnabled:i}}}}},root:c("JSResourceForInteraction")("MWChatEncryptedBackupsSettingsDialog.react").__setRef("MWChatEncryptedBackupsSettingsDialog.entrypoint")};g["default"]=a}),98);
__d("MWXIconMenuItemSecureStorage",["MWXSvgIcon","SVGIcon","cr:9612","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgMenuItemIcon(d("SVGIcon").svgIcon(b("cr:9612")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWChatSidebarEncryptedBackupsMenuItem.react",["fbt","MAWEncryptedBackupsStateManager","MWChatEncryptedBackupsSettingsDialog.entrypoint","MWJewelPopoverDialogContext.react","MWXIconMenuItemSecureStorage","MWXMenuItem.react","cr:4062","promiseDone","react","requireDeferred","useMWXEntryPointDialog","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react")),l=j.useContext,m=c("requireDeferred")("MWEncryptedBackupsFetchBackupMetadata").__setRef("MWChatSidebarEncryptedBackupsMenuItem.react"),n=h._("__JHASH__Lde2nkz74OF__JHASH__");function a(){var a=c("useMWXEntryPointDialog")(c("MWChatEncryptedBackupsSettingsDialog.entrypoint"),{}),e=a[0];a=l(c("MWJewelPopoverDialogContext.react"));var f=a.setIsOpenForDialog,g=(i||(i=c("useReStore")))(),j=b("cr:4062")({});a=function(){d("MAWEncryptedBackupsStateManager").eligibleForEBUX(j)&&m.onReady(function(a){a=a.fetchBackupMetadata;c("promiseDone")(a(g))}),f(!0),e({})};var o=j===-1||j===1;return k.jsx(c("MWXMenuItem.react"),{auxItem:o?void 0:{auxText:j===3?h._("__JHASH__zuHjNmdQ8AD__JHASH__"):h._("__JHASH__YsrKpzbN1OC__JHASH__"),type:"text"},icon:c("MWXIconMenuItemSecureStorage"),onClick:a,primaryText:n,role:"menuitemcheckbox",testid:void 0})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("LSEncryptedBackupsOnboardingDecision",[],(function(a,b,c,d,e,f){a=Object.freeze({FAILURE:-1,NO_DECISION_MADE:0,BACKUP_CREATED:1,STORE_ON_DEVICE_ONLY:2});f["default"]=a}),66);
__d("LSEncryptedBackupsVirtualDeviceType",[],(function(a,b,c,d,e,f){a=Object.freeze({OFFLINE:1,HSM:2,BLOCK_STORE:3,KEYCHAIN:5,ICLOUD_KVS:6,GOOGLE_DRIVE:7,CLOUDKIT:8,ICLOUD_DRIVE:9,PASSKEY:10,ICLOUD_KEYCHAIN:11,GOOGLE_ONE_AUTO_BACKUP:12});f["default"]=a}),66);
__d("useMWEncryptedBackupsFetchBackupIdsV2",["Base64Utils","CometRelay","FBLogger","I64","LSEncryptedBackupsBackupTenancy","LSEncryptedBackupsOnboardingDecision","LSEncryptedBackupsVirtualDeviceType","LSIntEnum","LSShape","LSVec","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsListenForChangesToBackupStateInitPath","Promise","QPLEvent","QPLUserFlow","WebSession","cr:4388","cr:7191","promiseDone","react","requireDeferred","useAsyncReStore","useMWEncryptedBackupsFetchBackupIdsV2Impl_query.graphql","useMWEncryptedBackupsFetchBackupIdsV2Query.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n;e=k||d("react");var o=e.useEffect,p=e.useRef,q=e.useState,r=c("requireDeferred")("mwEBUpdateBackupsTable").__setRef("useMWEncryptedBackupsFetchBackupIdsV2");function s(a){if(a!=null){a=a;a=c("LSEncryptedBackupsOnboardingDecision")[a];return a}return void 0}function t(a){if(a!=null){a=a;a=c("LSEncryptedBackupsBackupTenancy")[a];return(l||(l=d("LSIntEnum"))).ofNumber(a)}return void 0}function u(a){var e=a.data,f=a.dbPromise,g=a.isInitalLoad,h=g===void 0?!1:g,i=a.setListenForChangesToBackupState,k=e.xfb_backup,m=k==null?void 0:k.id;if(k!=null&&m!=null){var o=!1;(k==null?void 0:k.has_otc_eligible_devices)!=null?o=k==null?void 0:k.has_otc_eligible_devices:c("FBLogger")("labyrinth_web").mustfix("failed to retrieve has_otc_eligible_devices. defaulting to false");var p=c("LSVec").ofArray([d("LSShape").ofRecord({backup_id:(n||(n=d("I64"))).of_string(m),backup_tenancy:t(k.backup_tenancy)})]),q=[];k.virtual_devices.forEach(function(a){var b,e=a.client_generated_id;if(m==null||e==null||a.device_type==null){c("FBLogger")("labyrinth_web").warn("Invalid virtual device fetched in fetchBackupsIdsV2.");return}var f="REQUIRES_MIGRATION";f=a.migration_status===f;var g=a.device_type;g=c("LSEncryptedBackupsVirtualDeviceType")[g];q.push(d("LSShape").ofRecord({backup_id:(n||(n=d("I64"))).of_string(m),virtual_device_ids:c("LSVec").ofArray([d("LSShape").ofRecord({virtual_device_id:d("Base64Utils").toArrayBuffer(e)})]),virtual_devices:c("LSVec").ofArray([d("LSShape").ofRecord({creation_time:(b=a.creation_time)!=null?b:void 0,device_created_on:(b=a.device_created_on)!=null?b:void 0,requires_hsm_migration:f,virtual_device_id:d("Base64Utils").toArrayBuffer(e),virtual_device_type:(l||(l=d("LSIntEnum"))).ofNumber(g)})])}))});var u=[];(g=k.devices)==null?void 0:g.edges.forEach(function(a){var b;if(((b=a.node)==null?void 0:b.id)==null)return;u.push(d("LSShape").ofRecord({device_id:(n||(n=d("I64"))).of_string((b=a.node)==null?void 0:b.id)}))});var v=k.encryption_management_delegator_id!=null?(n||(n=d("I64"))).of_string(k.encryption_management_delegator_id):void 0;c("promiseDone")((j||(j=b("Promise"))).all([r.load(),f]),function(a){var b=a[0],d=a[1];c("promiseDone")(b({backupIds:p,deviceIds:c("LSVec").ofArray(u),encryptionManagementDelegatorId:v,hasOtcEligibleDevices:o,isSuccess:!0,isUserOptedOut:(a=k.is_user_opted_out)!=null?a:void 0,storage:d,virtualDevices:c("LSVec").ofArray(q)}),function(){i(!0),h&&c("MWEncryptedBackupsListenForChangesToBackupStateInitPath").preloadEBData(d)})})}else{var w=s((a=e.xfb_eb_user_preferences)==null?void 0:a.onboarding_decision)===c("LSEncryptedBackupsOnboardingDecision").STORE_ON_DEVICE_ONLY;c("promiseDone")((j||(j=b("Promise"))).all([r.load(),f]),function(a){var b=a[0];a=a[1];c("promiseDone")(b({backupIds:c("LSVec").ofArray([]),deviceIds:c("LSVec").ofArray([]),hasOtcEligibleDevices:!1,isSuccess:!0,isUserOptedOut:w,storage:a,virtualDevices:c("LSVec").ofArray([])}),function(){i(!0)})})}}function v(a){var e=c("useAsyncReStore")(),f=p(!1),g=p(!0),i=q(!1),j=i[0],k=i[1];i=d("CometRelay").useRefetchableFragment(h!==void 0?h:h=b("useMWEncryptedBackupsFetchBackupIdsV2Impl_query.graphql"),a);var l=i[0],n=i[1];b("cr:4388")==null?void 0:b("cr:4388")({listenForChangesToBackupState:j});b("cr:7191")==null?void 0:b("cr:7191")(function(){f.current=!1;k(!0);var a=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").getActiveFlowIDs().includes((m||(m=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent))||c("QPLUserFlow").start(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent,{annotations:{string:{ebSessionIdentifier:a,fetchBackupIdsVersion:"GQL",sessionTabId:d("WebSession").getId()}}});n({},{fetchPolicy:"network-only"})});o(function(){if(f.current===!0)return;f.current=!0;c("QPLUserFlow").getActiveFlowIDs().includes((m||(m=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent))&&d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent});u({data:l,dbPromise:e,isInitalLoad:g.current,setListenForChangesToBackupState:k});g.current=!1},[l,e])}function a(){var a=d("CometRelay").useLazyLoadQuery(i!==void 0?i:i=b("useMWEncryptedBackupsFetchBackupIdsV2Query.graphql"),{});v(a)}g["default"]=a}),98);
__d("E2EEBackupSecretRestoreModule",["E2EEBackupCommon","Promise","QuickPerformanceLogger","VestaClient","VestaClientError","asyncToGeneratorRuntime","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("qpl")._(235874858,"168");function a(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){(i||(i=c("QuickPerformanceLogger"))).markerStart(j);i.markerAnnotate(j,{string:{product_use_case:e.productUseCase}});try{var g=(yield a.initLogin({clientId:e.clientId,productUseCase:e.productUseCase},f)),k=g.islandRsaPub,l=g.islandRsaPubSig,m=g.islandEd25519Pub,n=g.islandEd25519PubSig;g=g.isRegistered;(i||(i=c("QuickPerformanceLogger"))).markerPoint(j,"init_login_network_call");if(!g){(i||(i=c("QuickPerformanceLogger"))).markerAnnotate(j,{string:{failure_reason:"NOT_REGISTERED"}});i.markerEnd(j,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.NOT_REGISTERED)}g=(yield (h||(h=b("Promise"))).all([d("VestaClient").validateHsmKey(k,l),d("VestaClient").validateHsmKey(m,n)]));k=g[0];l=g[1];if(!k){(i||(i=c("QuickPerformanceLogger"))).markerAnnotate(j,{string:{failure_reason:"ISLAND_PUB_RSA_KEY_INVALID"}});i.markerEnd(j,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.ISLAND_PUB_RSA_KEY_INVALID)}if(!l){(i||(i=c("QuickPerformanceLogger"))).markerAnnotate(j,{string:{failure_reason:"ISLAND_PUB_ED25519_KEY_INVALID"}});i.markerEnd(j,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.ISLAND_PUB_ED25519_KEY_INVALID)}i.markerPoint(j,"verify_island_rsa_key");i.markerPoint(j,"verify_island_ed25519_key");n=e.vestaAccountPin;if(n==null)throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.MISSING_PIN_INPUT);else{g=new TextEncoder();k=(yield d("VestaClient").beginLogin(g.encode(n)));l=k.clientState;g=k.l1Message;(i||(i=c("QuickPerformanceLogger"))).markerPoint(j,"begin_login_vesta_client");n=(yield a.beginLogin({clientId:e.clientId,productUseCase:e.productUseCase,opaqueL1:g},f));k=n.opaqueL2;g=n.opaqueL2Sig;i.markerPoint(j,"begin_login_network_call");n=(yield d("VestaClient").finishLogin(k,g,m,l));k=n.exportKey;g=n.l3Message;m=n.sessionKey;i.markerPoint(j,"finish_login_vesta_client");l=(yield a.finishLogin({clientId:e.clientId,productUseCase:e.productUseCase,opaqueL3:g},f));n=l.loginSuccess;a=l.loginPayload;i.markerPoint(j,"finish_login_network_call");if(!n){(i||(i=c("QuickPerformanceLogger"))).markerAnnotate(j,{string:{failure_reason:"VESTA_SERVER_ERROR"}});i.markerEnd(j,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.VESTA_SERVER_ERROR)}if(a!=null){e=(yield d("VestaClient").unpackLoginPayload(a,m,k));g=e.userSecret;(i||(i=c("QuickPerformanceLogger"))).markerPoint(j,"unpack_login_payload");i.markerEnd(j,2);return g}i.markerAnnotate(j,{string:{failure_reason:"VESTA_SERVER_ERROR"}});i.markerEnd(j,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.VESTA_SERVER_ERROR)}}catch(a){if(a instanceof d("E2EEBackupCommon").BackupError)throw a;else if(a instanceof c("VestaClientError")){(i||(i=c("QuickPerformanceLogger"))).markerAnnotate(j,{string:{failure_reason:"VestaClientException: "+a.name}});i.markerEnd(j,3);if(a.name==="InvalidUserPassword")throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.INVALID_PASSWORD,a);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.VESTA_CLIENT_ERROR,a)}else{(i||(i=c("QuickPerformanceLogger"))).markerAnnotate(j,{string:{failure_reason:a.message}});i.markerEnd(j,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.NETWORK_PROVIDER_ERROR,a)}}});return k.apply(this,arguments)}g.restoreBackupSecret=a}),98);
__d("VestaServerGraphQLLoginProvider",["E2EEBackupUtil","Promise","RelayHooks","RelayModern","VestaServerGraphQLLoginProviderBeginLoginMutation.graphql","VestaServerGraphQLLoginProviderFinishLoginMutation.graphql","VestaServerGraphQLLoginProviderInitQuery.graphql","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function a(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){c=c.environment;c=(yield d("RelayHooks").fetchQuery(c,h!==void 0?h:h=b("VestaServerGraphQLLoginProviderInitQuery.graphql"),{request:{fbid:a.clientId,product_use_case:a.productUseCase,vesta_client_api_version:6}}).toPromise());a=c==null?void 0:c.fbid_based_auth_layer_vesta_login_init;c=a==null?void 0:a.base64url_encoded_island_rsa_pub;var e=a==null?void 0:a.base64url_encoded_island_rsa_pub_signature,f=a==null?void 0:a.base64url_encoded_opaque_pub,g=a==null?void 0:a.base64url_encoded_opaque_pub_signature,i=a==null?void 0:a.base64url_encoded_island_ed25519_pub,j=a==null?void 0:a.base64url_encoded_island_ed25519_pub_signature,k=a==null?void 0:a.is_registered;a=a==null?void 0:a.attempts_remaining;if(c!=null&&e!=null&&f!=null&&g!=null&&i!=null&&j!=null&&k!=null){var l;return{islandRsaPub:(l=d("E2EEBackupUtil")).decodeBase64Url(c),islandRsaPubSig:l.decodeBase64Url(e),opaquePub:l.decodeBase64Url(f),opaquePubSig:l.decodeBase64Url(g),islandEd25519Pub:l.decodeBase64Url(i),islandEd25519PubSig:l.decodeBase64Url(j),isRegistered:k,loginAttemptsRemaining:a}}throw new Error("GraphQL Response is Null")});return l.apply(this,arguments)}function c(a,c){var e=c.environment,f=i!==void 0?i:i=b("VestaServerGraphQLLoginProviderBeginLoginMutation.graphql"),g={input:{fbid:a.clientId,product_use_case:a.productUseCase,base64url_encoded_opaque_l1:d("E2EEBackupUtil").encodeBase64Url(a.opaqueL1)}};return new(k||(k=b("Promise")))(function(a,b){d("RelayModern").commitMutation(e,{mutation:f,variables:g,onCompleted:function(c){c=c.fbid_based_auth_layer_vesta_begin_login;var e=c==null?void 0:c.base64url_encoded_opaque_l2;c=c==null?void 0:c.base64url_encoded_opaque_l2_sig;if(e!=null&&c!=null){a({opaqueL2:d("E2EEBackupUtil").decodeBase64Url(e),opaqueL2Sig:d("E2EEBackupUtil").decodeBase64Url(c)});return}b(new Error("GraphQL Response is Null"))},onError:function(a){b(a)}})})}function e(a,c){var e=c.environment,f=c.updater;return new(k||(k=b("Promise")))(function(c,g){d("RelayModern").commitMutation(e,{mutation:j!==void 0?j:j=b("VestaServerGraphQLLoginProviderFinishLoginMutation.graphql"),variables:{input:{fbid:a.clientId,product_use_case:a.productUseCase,base64url_encoded_opaque_l3:d("E2EEBackupUtil").encodeBase64Url(a.opaqueL3)}},onCompleted:function(a){a=a.fbid_based_auth_layer_vesta_finish_login;var b=a==null?void 0:a.base64url_encoded_login_payload,e=a==null?void 0:a.login_success;a=a==null?void 0:a.attempts_remaining;if(e!=null){c({loginSuccess:e,loginPayload:b==null?b:d("E2EEBackupUtil").decodeBase64Url(b),attemptsRemaining:a});return}g(new Error("GraphQL Response is Null"))},onError:function(a){g(a)},updater:f})})}g.initLogin=a;g.beginLogin=c;g.finishLogin=e}),98);
__d("LSGetLatestThreadIds.nop",["I64","LSVec","MAWBridgeSendAndReceive","MAWRestoreRewriteUtils","Promise","ReQL","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=[];e=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(e.mi_act_mapping_table)).then(function(a){return a.map(function(a){a=a.jid;return(i||(i=d("I64"))).to_string(a)})}));if(e.length>0){var g=new Set(e);a.forEach(function(a){g.has(a)&&f.push(a)})}return(h||(h=b("Promise"))).resolve([c("LSVec").ofArray(f),!0])});return k.apply(this,arguments)}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableDescending(a.e2ee_threads.index("threadOrder")).take((i||(i=d("I64"))).to_int32(b))));return a.map(function(a){a=a.jid;return a.split("@")[0]})});return m.apply(this,arguments)}function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","getLatestThreadIds",{numThreads:(i||(i=d("I64"))).to_int32(a)}));return a});return o.apply(this,arguments)}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,k){k===void 0&&(k=!1);if((i||(i=d("I64"))).gt(g,(i||(i=d("I64"))).zero))try{e=d("MAWRestoreRewriteUtils").isOneDBEnabled()?yield l(a,g):yield n(g);return k&&c("gkx")("26384")?j(e,a):(h||(h=b("Promise"))).resolve([c("LSVec").ofArray(e),!0])}catch(a){return(h||(h=b("Promise"))).resolve([c("LSVec").ofArray([]),!1])}return(h||(h=b("Promise"))).resolve([c("LSVec").ofArray([]),!0])});function e(b,c,d,e,f){return a.apply(this,arguments)}return e}();g["default"]=a}),98);
__d("LSInitializeRestore",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSCreateDataTrace","LSCreateDataTraceID.nop","LSGetLatestThreadIds.nop","LSIsMobileClient","LSIssueMessageRangeQueryTask","LSIssueNewTask","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(a){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsInitializeRestoreStoredProcedure] Beginning execution."),c.nativeOperation(b("LSGetLatestThreadIds.nop"),"AdvancedCrypto",c.i64.cast([0,100]),!0).then(function(a){return a=a,d[1]=a[0],d[2]=a[1],a})},function(a){return c.forEach(c.db.table(231).fetch(),function(a){return a["delete"]()})},function(a){return d[2]?d[1]!==void 0?(d[9]=c.i64.of_int32(d[1].length),c.i64.gt(d[9],c.i64.cast([0,0]))?c.loopAsync(d[9],function(a){return d[10]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[1],d[10]).then(function(a){return a=a,d[11]=a[0],d[12]=a[1],a})},function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))&&c.i64.eq(a.backupTenancy,c.i64.cast([0,2]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){b=a.done;a=a.value;return b?d[13]=!1:(a.item,d[13]=!0)})},function(a){return d[13]?d[15]=c.i64.or_(c.i64.cast([0,73]),c.i64.cast([0,128])):d[15]=c.i64.cast([0,73]),c.nativeOperation(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[25]="EncryptedBackups MCD Trace ID",d[26]=c.i64.to_string(d[15]),d[17]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",d[17],d[25],d[17],d[26]].join("")),c.resolve()},function(a){return c.storedProcedure(b("LSCreateDataTrace"),d[16],void 0,void 0,"restore_messages",d[15])},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[18]?d[19]=!0:d[19]=!1,d[19]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[27]=c.createArray(),void 0!==void 0?d[28]=(d[27].push(void 0),d[27]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[27],c.i64.cast([0,3]))):c.resolve()},function(a){return d[16]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[16],c.i64.cast([0,2506]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[21]=!0:d[21]=!1,d[21]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[27]=c.createArray(),void 0!==void 0?d[28]=(d[27].push(void 0),d[27]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[27],c.i64.cast([0,3]))):c.resolve()},function(a){return d[22]=c.i64.of_float(Date.now()),c.db.table(231).add({threadId:d[11],lastUpdated:d[22],restoreStatus:c.i64.cast([0,1])})},function(a){return d[16]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[16],c.i64.cast([0,3602]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[23]?d[24]=!0:d[24]=!1,d[24]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[27]=c.createArray(),void 0!==void 0?d[28]=(d[27].push(void 0),d[27]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[27],c.i64.cast([0,3]))):c.resolve()},function(a){return c.storedProcedure(b("LSIssueMessageRangeQueryTask"),d[11],c.i64.cast([0,20]),void 0,!1,d[16],c.i64.cast([0,0]))}])}):c.resolve()):(d[9]=new c.Map(),d[9].set("error_code",c.i64.cast([0,107])),d[9].set("error_message",void 0==null?"":void 0),d[9].set("stored_procedure","initializeRestore"),d[10]=new c.Map(),d[10].set("act_thread_id",""),d[10].set("source",c.i64.cast([0,21])),d[10].set("restore_operation_type",c.i64.cast([0,3])),d[10].set("request_id",void 0),d[10].set("device_id",void 0),d[11]=new c.Map(),d[11].set("restore_context",d[10]),d[11].set("failure",d[9]),d[12]=d[11].get("restore_context"),d[11],d[13]=d[12].get("act_thread_id"),d[12],d[14]=c.toJSON(d[11]),c.storedProcedure(b("LSIssueNewTask"),["encrypted_backups_restore",":",d[13]].join(""),c.i64.cast([0,50030]),d[14],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):(d[9]=new c.Map(),d[9].set("error_code",c.i64.cast([0,107])),d[9].set("error_message",void 0==null?"":void 0),d[9].set("stored_procedure","initializeRestore"),d[10]=new c.Map(),d[10].set("act_thread_id",""),d[10].set("source",c.i64.cast([0,21])),d[10].set("restore_operation_type",c.i64.cast([0,3])),d[10].set("request_id",void 0),d[10].set("device_id",void 0),d[11]=new c.Map(),d[11].set("restore_context",d[10]),d[11].set("failure",d[9]),d[12]=d[11].get("restore_context"),d[11],d[13]=d[12].get("act_thread_id"),d[12],d[14]=c.toJSON(d[11]),c.storedProcedure(b("LSIssueNewTask"),["encrypted_backups_restore",":",d[13]].join(""),c.i64.cast([0,50030]),d[14],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0])))},function(a){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.random(),d[6]="Finishing execution. Execution time: ",d[7]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[8]=" ms",d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsInitializeRestoreStoredProcedure] ",d[5],d[6],d[5],d[7],d[5],d[8]].join("")),c.i64.eq(c.i64.mod_(d[4],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[9]=",",d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeRestoreStoredProcedure",[d[6],d[9],d[7],d[9],d[8]].join(""),d[10],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=c.i64.cast([0,0])}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSInitializeRestoreStoredProcedure",["LSInitializeRestore","cr:8709"],(function(a,b,c,d,e,f,g){function a(a){return c("LSInitializeRestore")(a)}g["default"]=a}),98);
__d("MWEncryptedBackupsInitializeRestore",["LSFactory","LSInitializeRestoreStoredProcedure"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a.runInTransaction(function(a){return c("LSInitializeRestoreStoredProcedure")(c("LSFactory")(a))},"readwrite")}g.initializeRestoreStoredProcedure=a}),98);